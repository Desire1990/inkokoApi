(function(){"use strict";var t={5116:function(t,e,s){var a=s(7195),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"body"}},[e("meta",{attrs:{name:"viewport",content:"width=device-width, initial-scale=1.0"}}),t.logged_in?e("div",{staticClass:"main"},[e("NavBar"),e("router-view"),e("div",{staticClass:"loggout",on:{click:t.loggout}},[e("fa",{attrs:{icon:"power-off"}})],1)],1):e("div",[e("Login")],1)])},r=[],o=s(8428),n=s.n(o),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"centered"},[e("form",{attrs:{action:".",method:"post"}},[e("center",[e("h2",{staticStyle:{"text-transform":"uppercase"}},[t._v("chicken breeding")]),e("img",{attrs:{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE0Xu_rtvk8mygc60iDSxns0rxJh2cJs7gzA&usqp=CAU",alt:"",width:"100%",height:"50%"}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_username"}},[t._v("Username:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username ",required:"",id:"id_username",autocomplete:"on"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_password"}},[t._v("Password:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password ",required:"",id:"id_password",autocomplete:"on"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),t.logs.length>0?e("label",{staticStyle:{color:"red"},attrs:{for:"id_password"}},[t._v(t._s(t.logs)+" ")]):t._e(),e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.logIn.apply(null,arguments)}}},[t._v("Log In")])]),e("center",[t._v(" Developped by "),e("b",[e("a",{attrs:{href:"https://github.com/Desire1990"}},[t._v("Desos")])])])],1)])},d=[],c={data(){return{logs:"",username:"",password:"",url:this.$store.state.url}},methods:{logIn(){this.logs="loging in...",n().post(this.url+"/login/",{username:this.username,password:this.password}).then((t=>{this.$store.state.user=t.data})).catch((t=>{t.response?this.logs=JSON.stringify(t.response.data):this.logs="erreur de connectivité"}))}}},u=c,h=s(1001),p=(0,h.Z)(u,l,d,!1,null,"c79e1af0",null),m=p.exports,v=function(){var t=this,e=t._self._c;return e("center",{staticClass:"parent"},[e("img",{attrs:{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE0Xu_rtvk8mygc60iDSxns0rxJh2cJs7gzA&usqp=CAU",alt:"",width:"100px",height:"50px"}}),e("router-link",{attrs:{to:"/home"}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"shopping-cart"}})],1),t._v(" HOME ")]),e("router-link",{attrs:{to:"/stock",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" STOCK "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"produit"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Produits ")],1),e("router-link",{attrs:{to:{name:"salle"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Salle ")],1),e("router-link",{attrs:{to:{name:"oeuf"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs ")],1)],1)]),e("router-link",{attrs:{to:"/hist",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" HISTORIQUES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"achats"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Achats ")],1),e("router-link",{attrs:{to:{name:"rations"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Rations ")],1),e("router-link",{attrs:{to:{name:"oeuf_vendu"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs vendus ")],1),e("router-link",{attrs:{to:{name:"paiements"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),e("span",[t._v("Paiements")])],1)],1)]),t.is_admin||t.userIs("gerant")?e("router-link",{attrs:{to:"/stats",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"chart-bar"}})],1),t._v(" STATISTIQUES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"statsproduct"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Produits ")],1),e("router-link",{attrs:{to:{name:"statsoeuf"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Oeufs ")],1),e("router-link",{attrs:{to:{name:"statsclients"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Clientèles ")],1),e("router-link",{attrs:{to:{name:"statspertes"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Pertes ")],1)],1)]):t._e(),e("router-link",{attrs:{to:"/pertes",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"trash-alt"}})],1),t._v(" PERTES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"produit"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Poules ")],1),e("router-link",{attrs:{to:{name:"oeuf"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs ")],1)],1)]),t.$store.state.user.groups.includes("admin")?e("router-link",{attrs:{to:"/users"}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"users"}})],1),t._v(" UTILISATEURS ")]):t._e(),e("router-link",{attrs:{to:"/transactions"}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" TRANSACTIONS ")]),e("br"),e("br"),e("br"),e("div",[e("h2",[t._v(t._s(this.user.username))])])],1)},_=[],f={computed:{is_admin(){return this.$store.state.user.is_admin}},methods:{showSubmenu(t){let e=t.target.getElementsByClassName("submenu")[0];e.style.display="block"},hideSubmenu(t){let e=t.target.getElementsByClassName("submenu")[0];e.style.display="none"}}},g=f,b=(0,h.Z)(g,v,_,!1,null,"14ead2c7",null),y=b.exports,C={components:{NavBar:y,Login:m},computed:{logged_in(){return null!=this.$store.state.user}},mounted(){var t=JSON.parse(localStorage.getItem("user"));t?this.$store.state.user=t:console.warn("il y'a pas de session"),0==this.$store.state.produits.length&&this.fetchProducts()},watch:{"$store.state.user":{deep:!0,handler(t){localStorage.setItem("user",JSON.stringify(t))}}},methods:{loggout(){confirm("êtes vous sur de vouloir deconnecter?")&&(this.$store.state.user=null)},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data,this.items=t.data})).catch((t=>{console.error(t)}))}}},$=C,w=(0,h.Z)($,i,r,!1,null,null,null),x=w.exports,q=s(2241),k=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])])],1)},P=[],D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"center"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text",placeholder:"Keyword",id:"id_username",autofocus:""},domProps:{value:t.keyword},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.keyword=e.target.value)}}}),e("button",{attrs:{type:"reset"},on:{click:function(e){t.keyword=""}}},[t._v("×")]),t.show_date?e("div",{staticStyle:{display:"inline"}},[e("button",{staticStyle:{"margin-left":"0"},on:{click:function(e){t.triggered=!t.triggered}}},[t._v(" Date ")]),t.triggered?e("div",{staticClass:"form"},[e("label",[t._v("Du:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.date.du,expression:"date.du"}],attrs:{type:"date",name:"date_du"},domProps:{value:t.date.du},on:{input:function(e){e.target.composing||t.$set(t.date,"du",e.target.value)}}}),e("label",[t._v("Au:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.date.au,expression:"date.au"}],attrs:{type:"date",name:"date_au"},domProps:{value:t.date.au},on:{input:function(e){e.target.composing||t.$set(t.date,"au",e.target.value)}}}),e("input",{staticStyle:{border:"1px solid black"},attrs:{type:"submit",value:"search"},on:{click:t.performSearch}})]):t._e()]):t._e()])},S=[],B={props:{show_date:{type:Boolean,default:!0}},components:{},data(){return{keyword:"",date:{du:null,au:null},triggered:!1}},watch:{keyword(t){this.$emit("searched",t)}},methods:{performSearch(){this.triggered=!1,this.$emit("changed",this.date)},changeColor(t){"red"==t&&(document.documentElement.style.setProperty("--primary","#d55"),document.documentElement.style.setProperty("--primary-light","#faa"),document.documentElement.style.setProperty("--hover","#faa")),"green"==t&&(document.documentElement.style.setProperty("--primary","green"),document.documentElement.style.setProperty("--primary-light","#595"),document.documentElement.style.setProperty("--hover","#595")),"blue"==t&&(document.documentElement.style.setProperty("--primary","#08a"),document.documentElement.style.setProperty("--primary-light","lightblue"),document.documentElement.style.setProperty("--hover","#29b"))}}},A=B,N=(0,h.Z)(A,D,S,!1,null,"30aac440",null),O=N.exports,T=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite_oeuf},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" "+t._s(t.item.nom))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(500))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite_oeuf)+" oeufs ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite_oeuf},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},L=[],I={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite_oeuf&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},E=I,F=(0,h.Z)(E,T,L,!1,null,"7a78873b",null),z=F.exports,Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.decrease(t.item.product.id)}}},[t._v("- ")]),e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.increase(t.item.product.id)}}},[t._v("+ ")]),e("div",{staticClass:"cart_body"},[e("div",[e("b",[t._v(t._s(t.item.quantite))]),t._v(" x Oeufs "),e("fa",{staticStyle:{color:"#b55"},attrs:{icon:"trash-alt"},on:{click:function(e){return t.remove(t.item)}}})],1),e("div",[e("b",[t._v(t._s(t.money(t.item.getTotale())))]),t._v(" Fbu ")])])])},j=[],U={props:{item:{type:Object,required:!0}},computed:{cart(){return this.$store.state.cart}},methods:{remove(t){let e=this.cart.find(t.product.id);this.cart.content.splice(e,1)}}},R=U,V=(0,h.Z)(R,Z,j,!1,null,"5f915766",null),J=V.exports,Q=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()},keydown:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ration Journalière")])]),e("form",{attrs:{method:"post"}},[e("div",[t._v(" La somme à consommer "),e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v("Fbu ")]),e("hr"),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du responsable")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.responsable.nom,expression:"responsable.nom"}],attrs:{type:"text",list:"noms",id:"id_nom"},domProps:{value:t.responsable.nom},on:{change:t.setTel,input:function(e){e.target.composing||t.$set(t.responsable,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Téléphone")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.responsable.telephone,expression:"responsable.telephone"}],attrs:{type:"text",id:"id_tel",list:"tels"},domProps:{value:t.responsable.telephone},on:{change:t.setNom,input:function(e){e.target.composing||t.$set(t.responsable,"telephone",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Valider"},on:{click:t.postCommande}})])]),e("datalist",{attrs:{id:"noms"}},t._l(t.responsables,(function(t){return e("option",{domProps:{value:t.nom}})})),0),e("datalist",{attrs:{id:"tels"}},t._l(t.responsables,(function(t){return e("option",{domProps:{value:t.telephone}})})),0)],1)])},M=[],G=(s(541),{props:{visible:{type:Boolean,default:!1}},data(){return{responsable:{nom:"",telephone:""},cart:this.$store.state.cart,dette_p:null,logs:""}},computed:{payee:{get(){return null==this.dette_p?this.cart.getTotal():this.dette_p},set(t){this.dette_p=t}},responsables(){return this.$store.state.responsables},host(){return this.$store.state.url},username(){return this.$store.state.user.username},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},mounted(){n().get(this.$store.state.url+"/responsable/",this.headers).then((t=>{this.$store.state.responsables=t.data.results})).catch((t=>{}))},methods:{close(){this.$emit("close")},setTel(){for(let t of this.responsables)if(t.nom==this.responsable.nom)return void(this.responsable.telephone=t.telephone)},setNom(){for(let t of this.responsables)if(t.telephone==this.responsable.telephone)return void(this.responsable.nom=t.nom)},postCommande(){if(this.payee<this.cart.getTotal()&&this.responsable.telephone.length<7)return void(this.logs="le numero est obligatoire pour les dettes");let t={},e=[],s=this.cart.getTotal(),a=this.payee<=s?this.payee:s,i=this.payee==this.cart.getTotal();for(let r of this.cart.content)e.unshift({id:r.product.id,quantite:r.quantite});t={items:e,responsable:this.responsable,payee:a,validated:i,a_payer:s},n().post(this.$store.state.url+"/ration/",t,this.headers).then((t=>{let s,a=t.data,i=this.$store.state.produits;this.responsable={nom:"",telephone:""},this.$store.state.cart.content=[],this.$store.state.rations.unshift(a),this.$emit("close");for(let r of e)s=i.find((t=>t.id==r.id)),s&&(s.quantite-=r.quantite)})).catch((t=>{t.response?this.logs=t.response.data.status:(this.logs="une erreur est survenue",console.error(t))}))}}}),H=G,K=(0,h.Z)(H,Q,M,!1,null,"34a8c1b4",null),X=K.exports,W={components:{SearchBar:O,Item:z,CartItem:J,DialogSubmit:X},data(){return{items:this.$store.state.salles,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite_oeuf>0))},empty_items(){return this.items.filter((t=>0==t.quantite_oeuf))}},methods:{performFilter(t){let e=this.$store.state.salles.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/salle/",t).then((t=>{this.$store.state.salles=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.salles.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home/ration"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.salles)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},Y=W,tt=(0,h.Z)(Y,k,P,!1,null,null,null),et=(tt.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])]),e("DialogSubmit",{attrs:{visible:t.confirm_vente},on:{close:function(e){t.confirm_vente=!1}}})],1)}),st=[],at=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" "+t._s(t.item.nom))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(t.item.prix_unitaire))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite)+" "+t._s(t.item.unite)+" ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},it=[],rt={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},ot=rt,nt=(0,h.Z)(ot,at,it,!1,null,"63e71cf8",null),lt=nt.exports,dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.decrease(t.item.product.id)}}},[t._v("- ")]),e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.increase(t.item.product.id)}}},[t._v("+ ")]),e("div",{staticClass:"cart_body"},[e("div",[e("b",[t._v(t._s(t.item.quantite))]),t._v(" x "+t._s(t.item.product.nom)+" "),e("fa",{staticStyle:{color:"#b55"},attrs:{icon:"trash-alt"},on:{click:function(e){return t.remove(t.item)}}})],1),e("div",[e("b",[t._v(t._s(t.money(t.item.getTotal())))]),t._v(" Fbu ")])])])},ct=[],ut={props:{item:{type:Object,required:!0}},computed:{cart(){return this.$store.state.cart}},methods:{remove(t){let e=this.cart.find(t.product.id);this.cart.content.splice(e,1)}}},ht=ut,pt=(0,h.Z)(ht,dt,ct,!1,null,"a95cc038",null),mt=pt.exports,vt={components:{SearchBar:O,Item:lt,CartItem:mt,DialogSubmit:X},data(){return{items:this.$store.state.produits,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite>0))},empty_items(){return this.items.filter((t=>0==t.quantite))}},methods:{performFilter(t){let e=this.$store.state.produits.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.produits.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.produits)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},_t=vt,ft=(0,h.Z)(_t,et,st,!1,null,null,null),gt=ft.exports,bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])])],1)},yt=[],Ct=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" Salle "+t._s(t.item.nom))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(t.item.prix.prix))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite)+" poulets ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},$t=[],wt={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},xt=wt,qt=(0,h.Z)(xt,Ct,$t,!1,null,"116523f0",null),kt=qt.exports,Pt={components:{SearchBar:O,Item:kt,CartItem:mt,DialogSubmit:X},data(){return{items:this.$store.state.salles,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite>0))},empty_items(){return this.items.filter((t=>0==t.quantite))}},methods:{performFilter(t){let e=this.$store.state.salles.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/salle/",t).then((t=>{this.$store.state.salles=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.salles.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home/ration"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.salles)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},Dt=Pt,St=(0,h.Z)(Dt,bt,yt,!1,null,null,null),Bt=(St.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("nom")]),e("th",[t._v("quantite")]),e("th",[t._v("date")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("prix d'achat Total")]),e("th",[e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")])])])]),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("th",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.nom))]),e("td",[t._v(t._s(s.quantite)+" "+t._s(s.unite))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(t.money(s.prix_unitaire))+" Fbu")]),e("td",[t._v(t._s(t.money(s.prix_unitaire*s.quantite))+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]),e("button",{on:{click:function(e){return e.preventDefault(),t.startAchat(s)}}},[t._v("Acheter")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total()))+" Fbu")]),e("th",{attrs:{colspan:"2"}})])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)}),At=[],Nt=(s(7658),function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"title"},[t._v(t._s(t.item.nom))]),e("div",[t._v(t._s(t.item.quantite)+" "+t._s(t.item.unite_sortant))]),e("div",{staticClass:"buttons"},[e("button",{on:{click:t.startEdit}},[t._v("Editer")]),e("button",{on:{click:t.startAchat}},[t._v("Acheter")])])])}),Ot=[],Tt={props:{item:{type:Object,required:!0}},methods:{startEdit(){this.$emit("edit")},startAchat(){this.$emit("achat")}}},Lt=Tt,It=(0,h.Z)(Lt,Nt,Ot,!1,null,"25cb0f8e",null),Et=It.exports,Ft=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.nom))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.nom,expression:"new_produit.nom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.nom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Unite d'achat:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.unite,expression:"new_produit.unite"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.unite},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"unite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Nouveau prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.prix_unitaire,expression:"new_produit.prix_unitaire"}],attrs:{type:"number",name:"prix",placeholder:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.prix_unitaire},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"prix_unitaire",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerPrix}})])])],1)])},zt=[],Zt={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerPrix(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().put(this.$store.state.url+`/produit/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.produits;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.produits[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},jt=Zt,Ut=(0,h.Z)(jt,Ft,zt,!1,null,"72f8f61c",null),Rt=Ut.exports,Vt=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ajouter un Produit")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.nom,expression:"produit.nom"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom du produit"},domProps:{value:t.produit.nom},on:{input:function(e){e.target.composing||t.$set(t.produit,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_entrant"}},[t._v("Unité d'achat:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.unite,expression:"produit.unite"}],attrs:{type:"text",id:"id_entrant",placeholder:"exemples: kg,carton,casier..."},domProps:{value:t.produit.unite},on:{input:function(e){e.target.composing||t.$set(t.produit,"unite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.prix_unitaire,expression:"produit.prix_unitaire"}],attrs:{type:"number",name:"prix",placeholder:"prix unitaire",id:"id_prix"},domProps:{value:t.produit.prix_unitaire},on:{input:function(e){e.target.composing||t.$set(t.produit,"prix_unitaire",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createProduct.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},Jt=[],Qt={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",produit:{},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" produits chargés",this.$refs.submit.innerText="upload"}},computed:{rapport(){let t="1 "+this.produit.unite+" vaut combien de "+this.produit.unite_sortant+"?";return this.produit.unite_sortant?t:"1 par defaut"},unite_sortant(){return this.produit.unite?this.produit.unite+" par defaut":"exemples: kg,carton,casier..."},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{close(){this.$emit("close")},uploadCSV(){n().post(this.$store.state.url+"/produit/",this.csv_array,this.headers).then((t=>{this.$store.state.produits=this.$store.state.produits.concat(t.data),this.csv_array=[],this.close()})).catch((t=>{console.error(t)}))},createProduct(){this.csv_array.length>0?this.uploadCSV():this.produit.nom?this.produit.unite?(this.produit.prix_achat||(this.produit.prix_achat=0,this.logs=""),n().post(this.$store.state.url+"/produit/",this.produit,this.headers).then((t=>{this.produit={},this.$store.state.produits.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))):this.logs="l'unité d'achat est obligatoire":this.logs="le nom est obligatoire"},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t='"sep=;"\nnom;unite;unite_sortant;rapport;prix_vente\n';this.download(t)},onPickFile(){this.$refs.fileInput.click()},loadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);this.csv_array=e}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].trim().split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].trim().split(";");for(let t=0;t<i.length;t++)r[a[t]]=i[t];s.push(r),r={}}return s}}},Mt=Qt,Gt=(0,h.Z)(Mt,Vt,Jt,!1,null,"0176c84a",null),Ht=Gt.exports,Kt=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Augmenter "+t._s(t.produit.nom))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"inline_field"},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"lg_qtt"}},[t._v(t._s(t.produit.unite))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.lg_qtt,expression:"lg_qtt"}],attrs:{type:"number",id:"lg_qtt"},domProps:{value:t.lg_qtt},on:{input:function(e){e.target.composing||(t.lg_qtt=e.target.value)}}})])]),e("div",{class:{inline_field:1!=t.produit.rapport}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"prix"}},[t._v("Prix unitaire")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.prix,expression:"prix"}],ref:"prix",attrs:{type:"number",id:"prix"},domProps:{value:t.prix},on:{input:function(e){e.target.composing||(t.prix=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"total"}},[t._v("Prix total")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.total,expression:"total"}],ref:"total",attrs:{type:"number",id:"total"},domProps:{value:t.total},on:{input:function(e){e.target.composing||(t.total=e.target.value)}}})])]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Details:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.details,expression:"details"}],attrs:{name:"prix"},domProps:{value:t.details},on:{input:function(e){e.target.composing||(t.details=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"submit"},on:{click:t.submit}})])])],1)])},Xt=[],Wt={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0},achat:{type:Object,required:!1}},data(){return{payee:0,lg_qtt:0,total:0,logs:"",sm_qtt:0,prix:0,details:""}},computed:{qttTotal(){return this.lg_qtt},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},watch:{prix(t){this.$refs.prix==document.activeElement&&(this.total=t*this.qttTotal)},total(t){this.$refs.total==document.activeElement&&(this.prix=t/this.qttTotal)},achat(t){console.log(t),1==this.produit.rapport?this.lg_qtt=t.quantite:this.sm_qtt=t.quantite,this.total=t.prix_total}},methods:{close(){this.lg_qtt=0,this.sm_qtt=0,this.$emit("close")},submit(){this.achat?this.performEdition():this.performAchat()},performAchat(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,produit:this.produit.id},e=this.$store.state.url;n().post(e+"/achat/",t,this.headers).then((t=>{let e=this.$store.state.produits,s=e.find((t=>t.id==this.produit.id));this.$store.state.achats.unshift(t.data),s?(s.quantite+=t.data.quantite,this.$emit("close")):this.logs="quelque chose a mal tourné"})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))},performEdition(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,produit:this.produit.id},e=this.$store.state.url;n().put(e+`/achat/${this.achat.id}/`,t,this.headers).then((t=>{this.produit.quantite-=this.achat.quantite,this.achat.quantite=t.data.quantite,this.produit.quantite+=t.data.quantite,this.achat.prix_total=t.data.prix_total,this.achat.prix_unitaire=t.data.prix_unitaire,this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},Yt=Wt,te=(0,h.Z)(Yt,Kt,Xt,!1,null,"2242b7c2",null),ee=te.exports,se={components:{SearchBar:O,Item:Et,EditDialog:Rt,AchatDialog:ee,ProduitDialog:Ht},data(){return{csvData:{},items:this.$store.state.produits,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.produits"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&n().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.prix_unitaire*e.quantite;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.produits.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},ae=se,ie=(0,h.Z)(ae,Bt,At,!1,null,"4a22f2c0",null),re=ie.exports,oe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("br"),e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("br"),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[e("thead",[e("tr",{staticClass:"panier-item",staticStyle:{"text-transform":"capitalize"}},[e("th",[t._v("id")]),e("th",[t._v("Salle")]),e("th",[t._v("Type de poulle")]),e("th",[t._v("responsable")]),e("th",[t._v("Telephone")]),e("th",[t._v("quantite")]),e("th",[t._v("oeufs pondus")]),e("th",[t._v("date")]),e("th",[e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")])])])]),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("th",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.nom))]),e("td",[t._v(t._s(s.type_poulle)+" ")]),e("td",[t._v(t._s(s.responsable.nom)+" "+t._s(s.responsable.prenom))]),e("td",[t._v(t._s(s.responsable.telephone)+" ")]),e("td",[t._v(t._s(s.quantite)+" poulles")]),e("td",[t._v(t._s(s.quantite_oeuf)+" oeufs")]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]),e("button",{on:{click:function(e){return e.preventDefault(),t.startAchat(s)}}},[t._v("Oeuf")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.total())+" poulles")]),e("th",[t._v(t._s(t.totale())+" oeufs")]),e("th",{attrs:{colspan:"2"}})])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,salle:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},ne=[],le=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.nom))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.nom,expression:"new_produit.nom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.nom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Quantite:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.quantite,expression:"new_produit.quantite"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.quantite},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"quantite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Type de poule:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.type_poulle,expression:"new_produit.type_poulle"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.type_poulle},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"type_poulle",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Responsable:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.responsable,expression:"new_produit.responsable"}],attrs:{type:"number",name:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.responsable},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"responsable",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerSalle}})])])],1)])},de=[],ce={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerSalle(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().put(this.$store.state.url+`/salle/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.salles;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.salles[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},ue=ce,he=(0,h.Z)(ue,le,de,!1,null,"704a0ee8",null),pe=he.exports,me=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ajouter une Salle")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.salle.nom,expression:"salle.nom"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom du salle"},domProps:{value:t.salle.nom},on:{input:function(e){e.target.composing||t.$set(t.salle,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",[t._v("Selectionnez le type de poulle")]),e("br"),e("select",{directives:[{name:"model",rawName:"v-model",value:t.salle.type_poulle,expression:"salle.type_poulle"}],attrs:{type:"text",name:"cars_id",id:"id_entrant"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.salle,"type_poulle",e.target.multiple?s:s[0])}}},[e("option",[t._v("---- Selection d'une type ----")]),e("option",{attrs:{value:"poulet pondeuse"}},[t._v("Poulet pondeuse")]),e("option",{attrs:{value:"poulet en chair"}},[t._v("Poulet en chair")])])]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Quantite:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.salle.quantite,expression:"salle.quantite"}],attrs:{type:"text",id:"id_nom",placeholder:"le nombre de poulles"},domProps:{value:t.salle.quantite},on:{input:function(e){e.target.composing||t.$set(t.salle,"quantite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du responsable")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.responsable.nom,expression:"responsable.nom"}],attrs:{type:"text",list:"noms",id:"id_nom"},domProps:{value:t.responsable.nom},on:{change:t.setTel,input:function(e){e.target.composing||t.$set(t.responsable,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Téléphone")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.responsable.telephone,expression:"responsable.telephone"}],attrs:{type:"text",id:"id_tel",list:"tels"},domProps:{value:t.responsable.telephone},on:{change:t.setNom,input:function(e){e.target.composing||t.$set(t.responsable,"telephone",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticStyle:{float:"right"}},[e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createProduct.apply(null,arguments)}}},[t._v(" Créer ")])])]),e("datalist",{attrs:{id:"noms"}},t._l(t.responsables,(function(t){return e("option",{domProps:{value:t.nom}})})),0),e("datalist",{attrs:{id:"tels"}},t._l(t.responsables,(function(t){return e("option",{domProps:{value:t.tel}})})),0)],1)])},ve=[],_e={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",salle:{nom:"",type_poulle:"",quantite:0},selectedId:null,responsable:{nom:"",telephone:""},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" produits chargés",this.$refs.submit.innerText="upload"}},computed:{responsables(){return this.$store.state.responsables},host(){return this.$store.state.url},username(){return this.$store.state.user.username},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},mounted(){this.responsables.length<1&&n().get(this.$store.state.url+"/responsable/",this.headers).then((t=>{this.$store.state.responsables=t.data.results})).catch((t=>{}))},methods:{close(){this.$emit("close")},setTel(){for(let t of this.responsables)if(t.nom==this.responsable.nom)return void(this.responsable.telephone=t.telephone)},setNom(){for(let t of this.responsables)if(t.telephone==this.responsable.telephone)return void(this.responsable.nom=t.nom)},createProduct(){n().post(this.$store.state.url+"/salle/",{responsable:this.responsable,nom:this.salle.nom,type_poulle:this.salle.type_poulle,quantite:this.salle.quantite},this.headers).then((t=>{this.$store.state.salles.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))}}},fe=_e,ge=(0,h.Z)(fe,me,ve,!1,null,"47037f84",null),be=ge.exports,ye=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Oeuf pondu dans salle "+t._s(t.salle.nom))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Quantite:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.lg_qtt,expression:"lg_qtt"}],attrs:{type:"text",name:"prix"},domProps:{value:t.lg_qtt},on:{input:function(e){e.target.composing||(t.lg_qtt=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Commentaire:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.commentaire,expression:"commentaire"}],attrs:{type:"text",name:"prix"},domProps:{value:t.commentaire},on:{input:function(e){e.target.composing||(t.commentaire=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"submit"},on:{click:t.performAchat}})])])],1)])},Ce=[],$e={props:{visible:{type:Boolean,default:!1},salle:{type:Object,required:!0},achat:{type:Object,required:!1}},data(){return{payee:0,lg_qtt:0,total:0,logs:"",sm_qtt:0,prix:0,commentaire:"",quantite:0}},computed:{qttTotal(){return this.lg_qtt},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},watch:{prix(t){this.$refs.prix==document.activeElement&&(this.total=t*this.qttTotal)},total(t){this.$refs.total==document.activeElement&&(this.prix=t/this.qttTotal)},achat(t){console.log(t),1==this.salle.rapport?this.lg_qtt=t.quantite:this.sm_qtt=t.quantite,this.total=t.prix_total}},methods:{close(){this.lg_qtt=0,this.sm_qtt=0,this.$emit("close")},performAchat(){let t={quantite:this.qttTotal,commentaire:this.commentaire,salle:this.salle.id},e=this.$store.state.url;n().post(e+"/oeuf/",t,this.headers).then((t=>{let e=this.$store.state.salles,s=e.find((t=>t.id==this.salle.id));this.$store.state.oeufs.unshift(t.data),s?(s.quantite_oeuf+=t.data.quantite,this.$emit("close")):this.logs="quelque chose a mal tourné"})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))},performEdition(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,salle:this.salle.id},e=this.$store.state.url;n().put(e+`/achat/${this.achat.id}/`,t,this.headers).then((t=>{this.salle.quantite-=this.achat.quantite,this.achat.quantite=t.data.quantite,this.salle.quantite+=t.data.quantite,this.achat.prix_total=t.data.prix_total,this.achat.prix_unitaire=t.data.prix_unitaire,this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},we=$e,xe=(0,h.Z)(we,ye,Ce,!1,null,"a9c64ba8",null),qe=xe.exports,ke={components:{SearchBar:O,Item:Et,EditDialog:pe,AchatDialog:qe,ProduitDialog:be},data(){return{csvData:{},items:this.$store.state.salles,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.salles"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&n().get(this.$store.state.url+"/salle/",t).then((t=>{this.$store.state.salles=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.quantite;return t},totale(){let t=0;for(let e of this.items)t+=e.quantite_oeuf;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.salles.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())|e.type_poulle.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},Pe=ke,De=(0,h.Z)(Pe,oe,ne,!1,null,"1db1afac",null),Se=De.exports,Be=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("div",[e("button",{staticStyle:{float:"right","margin-right":"40px",margin:"20px"},on:{click:function(e){t.add_mod=!0}}},[e("fa",{attrs:{icon:"upload"}}),t._v(" Vendre Oeuf ")],1),e("button",{staticStyle:{float:"right","margin-right":"40px",margin:"20px"},on:{click:function(e){t.add_mode=!0}}},[e("fa",{attrs:{icon:"upload"}}),t._v(" Creer prix")],1)]),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[t._m(0),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("th",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.salle.nom))]),e("td",[t._v(t._s(s.quantite)+" oeufs")]),e("td",[t._v(t._s(t.datetime(s.date)))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"2"}},[t._v("total")]),e("th",[t._v(t._s(t.total())+" oeufs")]),e("th")])])])]),e("Oeuf",{attrs:{visible:t.add_mod},on:{close:t.exitEdition}}),e("Item",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},Ae=[function(){var t=this,e=t._self._c;return e("thead",{staticStyle:{"text-transform":"capitalize"}},[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("Salle")]),e("th",[t._v("quantite")]),e("th",[t._v("date")])])])}],Ne=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ajouter prix")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.prix.prix,expression:"prix.prix"}],attrs:{type:"text",id:"id_nom",placeholder:"le prix de l'oeuf"},domProps:{value:t.prix.prix},on:{input:function(e){e.target.composing||t.$set(t.prix,"prix",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createProduct.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},Oe=[],Te={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",prix:{},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},computed:{headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{close(){this.$emit("close")},createProduct(){this.prix.prix?n().post(this.$store.state.url+"/prix/",this.prix,this.headers).then((t=>{this.prix={},this.$store.state.prix.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)})):this.logs="le prix est obligatoire"}}},Le=Te,Ie=(0,h.Z)(Le,Ne,Oe,!1,null,"11cd5e9a",null),Ee=Ie.exports,Fe=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()},keydown:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Vente oeufs")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Quantite")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.oeuf.quantite,expression:"oeuf.quantite"}],attrs:{type:"number",list:"noms",id:"id_nom",placeholder:"quantite à vendre"},domProps:{value:t.oeuf.quantite},on:{input:function(e){e.target.composing||t.$set(t.oeuf,"quantite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du client")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.client.nom,expression:"client.nom"}],attrs:{type:"text",list:"noms",id:"id_nom"},domProps:{value:t.client.nom},on:{change:t.setTel,input:function(e){e.target.composing||t.$set(t.client,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Téléphone")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.client.tel,expression:"client.tel"}],attrs:{type:"text",id:"id_tel",list:"tels"},domProps:{value:t.client.tel},on:{change:t.setNom,input:function(e){e.target.composing||t.$set(t.client,"tel",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Vendre"},on:{click:t.postCommande}})])]),e("datalist",{attrs:{id:"noms"}},t._l(t.clients,(function(t){return e("option",{domProps:{value:t.nom}})})),0),e("datalist",{attrs:{id:"tels"}},t._l(t.clients,(function(t){return e("option",{domProps:{value:t.tel}})})),0)],1)])},ze=[],Ze={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",oeuf:{quantite:0},client:{nom:"",tel:""}}},computed:{clients(){return this.$store.state.clients},host(){return this.$store.state.url},username(){return this.$store.state.user.username},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},mounted(){this.clients.length<1&&n().get(this.$store.state.url+"/client/",this.headers).then((t=>{this.$store.state.clients=t.data.results})).catch((t=>{}))},methods:{close(){this.$emit("close")},setTel(){for(let t of this.clients)if(t.nom==this.client.nom)return void(this.client.tel=t.tel)},setNom(){for(let t of this.clients)if(t.tel==this.client.tel)return void(this.client.nom=t.nom)},postCommande(){if(this.client.tel.length<7)return void(this.logs="le numero est obligatoire pour les dettes");let t={};t={client:this.client},n().post(this.$store.state.url+"/oeuf_vendu/",{client:this.client,quantite:this.oeuf.quantite},this.headers).then((t=>{let e=t.data;this.client={nom:"",tel:""},this.oeuf={quantite:""},this.$store.state.oeufs_vendus.unshift(e),this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:(this.logs="une erreur est survenue",console.error(t))}))}}},je=Ze,Ue=(0,h.Z)(je,Fe,ze,!1,null,"3ba2d83f",null),Re=Ue.exports,Ve={components:{SearchBar:O,Item:Ee,Oeuf:Re},data(){return{csvData:{},items:this.$store.state.oeufs,active_item:{},edit_mode:!1,add_mod:!1,add_mode:!1}},watch:{"$store.state.oeufs"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&n().get(this.$store.state.url+"/oeuf/",t).then((t=>{this.$store.state.oeufs=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.quantite;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.add_mod=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.oeufs.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},Je=Ve,Qe=(0,h.Z)(Je,Be,Ae,!1,null,"fb25f0ae",null),Me=Qe.exports,Ge=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table dettes"},[t._m(0),e("tbody",{attrs:{id:"dettes"}},t._l(t.dettes,(function(s){return e("tr",{class:{uncommited:s.uncommited>0}},[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.client))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.a_payer)+" Fbu")]),e("td",[t._v(t._s(s.payee+s.uncommited)+" Fbu")]),e("td",[t._v(t._s(s.reste-s.uncommited)+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[s.uncommited<s.reste?e("button",{on:{click:function(e){return t.rembourser(s)}}},[t._v(" payer ")]):t._e()])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.totals.a_payer)+" Fbu")]),e("th",[t._v(t._s(t.totals.payee)+" Fbu")]),e("th",[t._v(t._s(t.totals.reste)+" Fbu")]),e("th")])])])]),e("RemboursDialog",{attrs:{visible:t.rembours_opened,dette:t.active_dette},on:{close:function(e){t.rembours_opened=!1}}})],1)},He=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("client")]),e("th",[t._v("Date")]),e("th",[t._v("somme")]),e("th",[t._v("payée")]),e("th",[t._v("Reste")]),e("th",[t._v("options")])])])}],Ke=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Client")])]),e("form",{attrs:{method:"post"}},[e("div",[t._v(" La somme à payer "),e("b",[t._v(t._s(t.money(t.reste)))]),t._v("Fbu ")]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_payee"}},[t._v("La somme payée")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.payee,expression:"payee"}],attrs:{type:"number",id:"id_payee"},domProps:{value:t.payee},on:{input:function(e){e.target.composing||(t.payee=e.target.value)}}})]),e("div",[t._v(" La somme à retourner "),e("b",[t._v(t._s(t.money(t.dette.reste-t.payee)))]),t._v("Fbu ")]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Payer"},on:{click:t.makePayment}})])])],1)])},Xe=[],We={props:{visible:{type:Boolean,default:!1},dette:{type:Object,required:!0}},data(){return{dette_p:null,logs:""}},computed:{payee:{get(){return""==this.dette_p?0:null!=this.dette_p?this.dette_p:this.reste},set(t){this.dette_p=t}},reste(){return this.dette.reste-this.dette.uncommited}},methods:{close(){this.dette_p=null,this.$emit("close")},makePayment(t){this.payee=this.payee>this.reste?this.reste:this.payee;let e={somme:this.payee,commande:this.dette.id},s={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().post(this.$store.state.url+"/paiement/",e,s).then((t=>{let e=t.data,s=this.$store.state.commandes.find((t=>t.id==this.dette.id)),a=this.$store.state.dettes.find((t=>t.id==this.dette.id));s&&(s.uncommited=e.somme),a&&(this.dette.uncommited+=e.somme),this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},Ye=We,ts=(0,h.Z)(Ye,Ke,Xe,!1,null,"82aedf74",null),es=ts.exports,ss={components:{SearchBar:O,RemboursDialog:es},data(){return{dettes:this.$store.state.dettes,rembours_opened:!1,active_dette:{},query_date:!1}},computed:{totals(){let t={a_payer:0,payee:0,reste:0};if(0==this.dettes.length)return t;for(let e of this.dettes)t.a_payer+=e.a_payer,t.payee+=e.payee,t.reste+=e.reste-e.uncommited;return t}},methods:{searchItem(t){let e={};""!=t?(t=t.toLowerCase(),e=this.dettes.filter((e=>e.id==t||e.user.toLowerCase().includes(t)||this.datetime(e.date).includes(t)||e.client.toLowerCase().includes(t))),this.dettes=e):this.dettes=this.$store.state.dettes},rembourser(t){this.active_dette=t,this.rembours_opened=!0},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/commande/dettes/",t).then((t=>{this.$store.state.dettes=t.data,this.dettes=t.data,this.$store.state.dettes_fetched=!0})).catch((e=>{if("token_not_valid"==e.response.data.code){let e={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",e).then((e=>{this.$store.state.user.access=e.data.access,t.headers.Authorization="Bearer "+e.data.access})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/commande/dettes/"+e+"/"+s+"/",a).then((t=>{this.query_date=!0,this.dettes=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))}},mounted(){this.$store.state.dettes_fetched||this.fetchData()}},as=ss,is=(0,h.Z)(as,Ge,He,!1,null,"0d9b744c",null),rs=(is.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!0},on:{changed:t.filterByDate,searched:t.performFilter}})],1),e("br"),e("div",[t.$store.state.user.groups.includes("admin")?e("label",[e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")])]):t._e()]),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[t._m(0),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("th",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.nom)+" "+t._s(s.prenom))]),e("td",[t._v(t._s(s.telephone))]),e("td",[t._v(t._s(t.money(s.montant))+" Fbu")]),e("td",[t._v(t._s(t.datetime(s.date)))]),0==s.validated?e("td",[e("div",{staticClass:"btns"},[t.$store.state.user.groups.includes("admin")?e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]):t._e(),t.$store.state.user.groups.includes("admin")?e("button",{staticStyle:{"background-color":"red"},on:{click:function(e){return e.preventDefault(),t.Delete(s)}}},[t._v("Delete")]):t._e()]),e("div",{staticClass:"btns"},[t.$store.state.user.groups.includes("gestionnaire")?e("button",{staticClass:"valider",on:{click:function(e){return e.preventDefault(),t.Valider(s)}}},[t._v("valider")]):t._e()])]):e("td")])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("Total")]),e("th",[t._v(t._s(t.money(t.total()))+" Fbu")]),e("th",{attrs:{colspan:"3"}})])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)}),os=[function(){var t=this,e=t._self._c;return e("thead",{staticStyle:{"text-transform":"capitalize"}},[e("tr",{staticClass:"panier-item"},[e("th",[t._v("#")]),e("th",[t._v("nom & Prenom")]),e("th",[t._v("telephone")]),e("th",[t._v("montant")]),e("th",[t._v("date")]),e("th",[t._v("valider")])])])}],ns=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.montant))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.nom,expression:"new_produit.nom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.nom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.prenom,expression:"new_produit.prenom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.prenom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"prenom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Adresse:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.adresse,expression:"new_produit.adresse"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.adresse},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"adresse",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Telephone:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.telephone,expression:"new_produit.telephone"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.telephone},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"telephone",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Nouveau montant:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.montant,expression:"new_produit.montant"}],attrs:{type:"number",name:"prix",placeholder:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.montant},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"montant",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerPrix}})])])],1)])},ls=[],ds={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerPrix(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().put(this.$store.state.url+`/transaction/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.transactions;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.transactions[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},cs=ds,us=(0,h.Z)(cs,ns,ls,!1,null,"35b4ac38",null),hs=us.exports,ps=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Creer Transaction")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.nom,expression:"transaction.nom"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom "},domProps:{value:t.transaction.nom},on:{input:function(e){e.target.composing||t.$set(t.transaction,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.prenom,expression:"transaction.prenom"}],attrs:{type:"text",id:"id_nom",placeholder:"le prenom"},domProps:{value:t.transaction.prenom},on:{input:function(e){e.target.composing||t.$set(t.transaction,"prenom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Adresse:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.adresse,expression:"transaction.adresse"}],attrs:{type:"text",id:"id_nom",placeholder:"l'adresse'"},domProps:{value:t.transaction.adresse},on:{input:function(e){e.target.composing||t.$set(t.transaction,"adresse",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_entrant"}},[t._v("Telephone:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.telephone,expression:"transaction.telephone"}],attrs:{type:"text",id:"id_entrant",placeholder:"exemples: +25779462806"},domProps:{value:t.transaction.telephone},on:{input:function(e){e.target.composing||t.$set(t.transaction,"telephone",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Montant:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.montant,expression:"transaction.montant"}],attrs:{type:"number",name:"prix",placeholder:"le montant",id:"id_prix"},domProps:{value:t.transaction.montant},on:{input:function(e){e.target.composing||t.$set(t.transaction,"montant",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createTransaction.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},ms=[],vs={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",transaction:{},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" transactions chargés",this.$refs.submit.innerText="upload"}},computed:{headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{close(){this.$emit("close")},createTransaction(){this.csv_array.length>0?this.uploadCSV():this.transaction.nom?this.transaction.prenom?this.transaction.adresse?this.transaction.telephone?(this.transaction.montant||(this.transaction.montant=0,this.logs=""),n().post(this.$store.state.url+"/transaction/",this.transaction,this.headers).then((t=>{this.transaction={},this.$store.state.transactions.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))):this.logs="le telephone est obligatoire":this.logs="l'adresse est obligatoire":this.logs="le prenom est obligatoire":this.logs="le nom est obligatoire"},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t='"sep=;"\nnom;unite;unite_sortant;rapport;prix_vente\n';this.download(t)},onPickFile(){this.$refs.fileInput.click()},loadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);this.csv_array=e}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].trim().split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].trim().split(";");for(let t=0;t<i.length;t++)r[a[t]]=i[t];s.push(r),r={}}return s}}},_s=vs,fs=(0,h.Z)(_s,ps,ms,!1,null,"543919d2",null),gs=fs.exports,bs={components:{SearchBar:O,Item:Et,EditDialog:hs,AchatDialog:ee,ProduitDialog:gs},data(){return{csvData:{},items:this.$store.state.transactions,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.transactions"(t){this.items=t}},methods:{Delete(t){let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};confirm("Delete "+t.id)&&n()["delete"](this.$store.state.url+`/transaction/${t.id}/`,e).then((t=>(this.fetchData(),t)))},successAlert(){this.$swal({type:"success",title:"Valider la transaction",text:"Transaction validée avec succès!!!!"})},Valider(t){let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+`/transaction/${t.id}/valider/`,e).then((t=>{this.fetchData(),this.successAlert()}))},performFilter(t){let e=this.$store.state.transactions.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())|e.telephone.toLowerCase().includes(t.toLowerCase())|e.prenom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&n().get(this.$store.state.url+"/transaction/",t).then((t=>{this.$store.state.transactions=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+`/transaction/?du=${e}&au=${s}`,a).then((t=>{this.query_date=!0,this.items=t.data.results})).catch((t=>{this.query_date=!1,console.log(t)}))},total(){let t=0;for(let e of this.items)1==e.validated&&(t+=e.montant);return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()}},mounted(){this.fetchData()}},ys=bs,Cs=(0,h.Z)(ys,rs,os,!1,null,"166bfe6c",null),$s=Cs.exports,ws=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:t.userIs("admin")},on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table achats"},[t._m(0),e("tbody",{attrs:{id:"achats"}},t._l(t.achats,(function(s,a){return e("tr",[e("th",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(s.quantite)+" "+t._s(s.produit.unite))]),e("td",[t._v(t._s(t.money(s.prix_total))+" Fbu")]),e("td",[t._v(t._s(s.user))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.details))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th"),e("th"),e("th")])])])]),e("AchatDialog",{attrs:{visible:t.achat_mode,achat:t.active_item,produit:t.produit},on:{close:t.exitEdition}})],1)},xs=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item",staticStyle:{"text-transform":"capitalize"}},[e("th",[t._v("#")]),e("th",[t._v("nom")]),e("th",[t._v("quantité")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("acheteur")]),e("th",[t._v("date")]),e("th",[t._v("Detail")])])])}],qs={data(){return{achats:this.$store.state.achats,query_date:!1,active_item:null,achat_mode:!1}},components:{SearchBar:O,AchatDialog:ee},watch:{"$store.state.achats"(t){this.achats=this.$store.state.achats}},computed:{total(){let t=0;if(0==this.achats.length)return t;for(let e of this.achats)t+=e.prix_total;return t},produit(){if(!this.active_item)return{rapport:1};let t;return console.log(this.active_item),t=this.$store.state.produits.find((t=>t.nom==this.active_item.produit)),t}},methods:{searchItem(t){let e={};this.achats=this.$store.state.achats,""!=t&&(t=t.toLowerCase().split(","),e=this.achats.filter((e=>t[1]?(e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0]))&&(e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0])):e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0]))),this.achats=e)},getMonday(){let t=new Date;var e=t.getDay(),s=t.getDate()-e+(0==e?-6:1);return new Date(t.setDate(s)).toISOString()},fetchAchats(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=`date__lte=${(new Date).toISOString()}&date__gte=${this.getMonday()}`;n().get(this.$store.state.url+`/achat/?${e}`,t).then((t=>{this.$store.state.achats=t.data.results,this.achats=t.data.results})).catch((e=>{if("token_not_valid"==e.response.data.code){let e={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",e).then((e=>{this.$store.state.user.access=e.data.access,t.headers.Authorization="Bearer "+e.data.access})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=new Date(t.du).toISOString(),s=new Date(t.au).toISOString(),a=`date__lte=${s}&date__gte=${e}`,i={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+`/achat/?${a}`,i).then((t=>{this.query_date=!0,this.$store.state.achats=t.data.results})).catch((t=>{this.query_date=!1,console.error(t)}))},modifier(t){this.active_item=t,this.achat_mode=!0},exitEdition(){this.achat_mode=!1}},mounted(){this.$store.state.achats_fetched||this.fetchAchats()}},ks=qs,Ps=(0,h.Z)(ks,ws,xs,!1,null,"15d77af9",null),Ds=Ps.exports,Ss=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:t.userIs("admin")||t.userIs("gerant")},on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table commandes"},[t._m(0),e("tbody",{attrs:{id:"commandes"}},t._l(t.rations.results,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.responsable))]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return t.showDetails(s)}}},[t._v(" détails ")])])])])})),0)])]),e("DetailsDialog",{attrs:{visible:t.details_opened,commande:t.active_commande},on:{close:function(e){t.details_opened=!1}}})],1)},Bs=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("Date")]),e("th",[t._v("Responsable")]),e("th",[t._v("options")])])])}],As=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h2",[t._v("Ration")])]),0==t.ventes.length?e("div",[t._v(t._s(t.action))]):e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table commandes"},[t._m(0),e("tbody",{attrs:{id:"commandes"}},t._l(t.ventes,(function(s){return e("tr",[e("td",{staticStyle:{color:"#aaa"}},[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v("x "+t._s(s.quantite)+t._s(s.produit.unite))]),e("td",[t._v(t._s(t.money(s.prix_achat))+" Fbu")]),e("td",[t._v(t._s(t.money(s.prix_achat*s.quantite))+" Fbu")])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.commande.a_payer))+" Fbu")])])])])])],1)])},Ns=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("quantite")]),e("th",[t._v("prix Unitaire")]),e("th",[t._v("total")])])])}],Os={data(){return{ventes:[],action:"récuperation des ventes..."}},props:{visible:{type:Boolean,default:!1},commande:{type:Object,required:!0}},watch:{visible(t){if(this.visible){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/vente/?commande="+this.commande.id,t).then((t=>{this.ventes=t.data.results,this.action="pas de details."})).catch((t=>{console.error(t)}))}}},methods:{close(){this.$emit("close")}}},Ts=Os,Ls=(0,h.Z)(Ts,As,Ns,!1,null,"61e6cd54",null),Is=Ls.exports,Es={components:{SearchBar:O,DetailsDialog:Is},data(){return{query_date:!1,rations:this.$store.state.rations,details_opened:!1,active_commande:{}}},computed:{totals(){let t={a_payer:0,payee:0,reste:0};if(0==this.commandes.length)return t;for(let e of this.commandes)t.a_payer+=e.a_payer,t.payee+=e.payee,t.reste+=e.reste;return t}},methods:{userIs(t){return this.$store.state.user.groups.includes(t)},searchItem(t){let e={};""!=t&&(t=t.toLowerCase(),t=t.toLowerCase().split(","),e=this.commandes.filter((e=>t[1]?(e.id==t[0]||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0]))&&(e.id==t[1]||e.user.toLowerCase().includes(t[1])||this.datetime(e.date).includes(t[1])):e.id==t[0]||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0]))),this.$store.state.commandes_fetched=!1,this.commandes=e)},showDetails(t){this.active_commande=t,this.details_opened=!0},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/ration/",t).then((t=>{this.$store.state.rations=t.data,this.rations=t.data,this.$store.state.commandes_fetched=!0})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchData()})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+`/ration/?du=${e}&au=${s}`,a).then((t=>{this.query_date=!0,this.rations=t.data})).catch((t=>{this.query_date=!1,console.log(t)}))}},mounted(){this.fetchData()}},Fs=Es,zs=(0,h.Z)(Fs,Ss,Bs,!1,null,"40d551e7",null),Zs=zs.exports,js=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table ventes"},[t._m(0),e("tbody",{attrs:{id:"ventes"}},t._l(Object.entries(t.grouped_ventes),(function(s){return e("tr",[e("td",[t._v(t._s(s[1].id))]),e("td",[t._v(t._s(s[0]))]),e("td",[t._v(t._s(s[1].quantite))]),e("td",[t._v(t._s(t.money(s[1].prix_achat||null)))]),e("td",[t._v(t._s(t.money(s[1].prix_vente)))]),e("td",[t._v(t._s(s[1].prix_achat?t.money(s[1].benefice):"-"))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.totals.achat))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.vente))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.benefice))+" Fbu")])])])])])])},Us=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("quantité vendue")]),e("th",[t._v("prix d'achat total")]),e("th",[t._v("prix de vente total")]),e("th",[t._v("benefice")])])])}],Rs={components:{SearchBar:O},data(){return{ventes:[],query_date:!1}},computed:{totals(){let t={achat:0,vente:0,benefice:0};for(let e of Object.entries(this.grouped_ventes))t.vente+=e[1].prix_vente||0,t.achat+=e[1].prix_achat||0,t.benefice+=e[1].benefice||0;return t},grouped_ventes(){let t={},e=null,s=0,a=0;for(let i of this.ventes)s=i.prix_vente*i.quantite,a=i.prix_achat*i.quantite,i.produit in t?(e=t[i.produit],e.quantite+=i.quantite,e.prix_vente+=s,e.prix_achat+=a,e.benefice+=i.prix_achat?s-a:0):e={id:i.produit_id,quantite:i.quantite,prix_achat:i.prix_achat*i.quantite,prix_vente:i.prix_vente*i.quantite,benefice:i.prix_achat?s-a:null},t[i.produit]=e;return t}},methods:{totalAchat(t){return t&&t.prix_achat?t.prix_achat*t.quantite:0},totalVente(t){return t?t.prix_vente*t.quantite:0},searchItem(t){this.ventes=""==t?this.$store.state.ventes:this.$store.state.ventes.filter((e=>e.produit.toLowerCase().includes(t.toLowerCase())))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}},i=`/vente/?commande__date__gte=${e} 00:00&commande__date__lte=${s} 23:59`;n().get(this.$store.state.url+i,a).then((t=>{this.ventes=t.data})).catch((t=>{console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=new Date,s=(new Date).toISOString(),a=new Date(e.setDate(1)).toISOString(),i=`/vente/?commande__date__gte=${a}&commande__date__lte=${s}`;n().get(this.$store.state.url+i,t).then((t=>{this.$store.state.ventes=t.data,this.ventes=t.data})).catch((t=>{}))}},mounted(){this.fetchData()}},Vs=Rs,Js=(0,h.Z)(Vs,js,Us,!1,null,"47bf9038",null),Qs=Js.exports,Ms=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:t.userIs("admin")||t.userIs("gestionnaire")},on:{changed:t.filterByDate,searched:t.performFilter}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table commandes"},[t._m(0),e("tbody",{attrs:{id:"commandes"}},t._l(t.items,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.client))]),e("td",[t._v(t._s(s.prix)+" Fbu")]),e("td",[t._v(t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.prix*s.quantite))+" Fbu")])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("Total")]),e("th",[t._v(t._s(t.totale())+" oeufs")]),e("th",[t._v(t._s(t.money(t.total()))+" Fbu")])])])])]),e("DetailsDialog",{attrs:{visible:t.details_opened,commande:t.active_commande},on:{close:function(e){t.details_opened=!1}}})],1)},Gs=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("Date")]),e("th",[t._v("Client")]),e("th",[t._v("Prix")]),e("th",[t._v("Quantite")]),e("th",[t._v("Total")])])])}],Hs={components:{SearchBar:O,DetailsDialog:Is},data(){return{query_date:!1,items:this.$store.state.oeufs_vendus,details_opened:!1,active_commande:{}}},watch:{"$store.state.items"(t){this.items=t}},methods:{total(){let t=0;for(let e of this.items)t+=e.prix*e.quantite;return t},totale(){let t=0;for(let e of this.items)t+=e.quantite;return t},userIs(t){return this.$store.state.user.groups.includes(t)},performFilter(t){let e=this.$store.state.oeufs_vendus.filter((e=>e.id==t|e.client.toLowerCase().includes(t.toLowerCase())|e.date.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/oeuf_vendu/",t).then((t=>{this.$store.state.oeufs_vendus=t.data.results,this.items=t.data.results,this.$store.state.commandes_fetched=!0})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchData()})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+`/oeuf_vendu/?du=${e}&au=${s}`,a).then((t=>{this.query_date=!0,this.items=t.data.results})).catch((t=>{this.query_date=!1,console.log(t)}))}},mounted(){this.fetchData()}},Ks=Hs,Xs=(0,h.Z)(Ks,Ms,Gs,!1,null,"0d76ade2",null),Ws=Xs.exports,Ys=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table stats"},[t._m(0),e("tbody",{attrs:{id:"stats"}},t._l(t.stats,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.nom))]),e("td",[t._v(t._s(s.tel))]),e("td",[t._v(t._s(s.commande))]),e("td",[t._v(t._s(t.money(s.total)))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")])])])])])])},ta=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("client")]),e("th",[t._v("télephone")]),e("th",[t._v("nombre de fois")]),e("th",[t._v("la somme payée")])])])}],ea={components:{SearchBar:O},data(){return{query_date:!1,stats:[]}},methods:{searchItem(t){let e={};if(""==t)return this.fetchData();e=this.query_date||""==t?this.stats.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase()))):this.$store.state.stats.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase()))),this.stats=e},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/client/"+e+"/"+s+"/",a).then((t=>{this.query_date=!0,this.stats=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/client/",t).then((t=>{this.$store.state.stats=t.data,this.stats=t.data.results,console.log(t.data)})).catch((t=>{}))}},computed:{total(){let t=0;if(0==this.stats.length)return t;for(let e of this.stats)t+=e.total;return t}},mounted(){this.fetchData()}},sa=ea,aa=(0,h.Z)(sa,Ys,ta,!1,null,"f13f08b2",null),ia=aa.exports,ra=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table pertes"},[t._m(0),e("tbody",{attrs:{id:"pertes"}},t._l(t.pertes,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(t.datetime(t.since)))]),e("td",[t._v(t._s(t.datetime(t.to)))]),e("td",[t._v(t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.total)))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")])])])])])])},oa=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("du")]),e("th",[t._v("au")]),e("th",[t._v("quantité perdu")]),e("th",[t._v("prix d'achat")])])])}],na={components:{SearchBar:O},data(){return{query_date:!1,pertes:[],to:String(new Date),since:new Date((new Date).setUTCDate((new Date).getUTCDate()-7))}},computed:{total(){let t=0;if(0==this.pertes.length)return t;for(let e of this.pertes)t+=e.total;return t}},methods:{searchItem(t){let e={};if(""==t)return this.fetchData();e=(this.query_date,this.pertes.filter((e=>e.id==t|e.produit.toLowerCase().includes(t.toLowerCase())))),this.pertes=e},filterByDate(t){this.since=t.du,this.to=t.au;let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/perte/stats/"+this.since+"/"+this.to+"/",e).then((t=>{this.query_date=!0,this.pertes=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().get(this.$store.state.url+"/perte/stats/",t).then((t=>{this.pertes=t.data})).catch((t=>{}))}},mounted(){this.fetchData()}},la=na,da=(0,h.Z)(la,ra,oa,!1,null,"927bcece",null),ca=da.exports,ua=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[t._m(0),e("tbody",{attrs:{id:"paiements"}},t._l(t.paiements,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.commande))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(t.money(s.somme))+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[t.user.is_admin?e("button",{on:{click:function(e){return t.validatePay(s)}}},[t._v("valider")]):t._e(),e("button",{on:{click:function(e){return t.deletePay(s)}}},[t._v("annuler")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th",[t.user.is_admin?e("button",[t._v(" valider tout ")]):t._e()])])])])])])},ha=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("commande")]),e("th",[t._v("Date")]),e("th",[t._v("somme")]),e("th",[t._v("options")])])])}],pa={components:{SearchBar:O},data(){return{paiements:this.$store.state.paiements,rembours_opened:!1,active_paiement:{},query_date:!1}},computed:{total(){let t=0;if(0==this.paiements.length)return t;for(let e of this.paiements)t+=e.somme;return t},user(){return this.$store.state.user},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{searchItem(t){let e={};if(""==t)return this.fetchPayements();e=this.query_date||""==t?this.paiements.filter((e=>e.id==t|e.commande.toLowerCase().includes(t.toLowerCase()))):this.$store.state.paiements.filter((e=>e.id==t|e.commande.toLowerCase().includes(t.toLowerCase()))),this.paiements=e},rembourser(t){this.active_paiement=t,this.rembours_opened=!0},deletePay(t){confirm("êtes-vous sur de vouloir annuler la paiement?")&&n()["delete"](this.$store.state.url+`/paiement/${t.id}/`,this.headers).then((e=>{let s=this.$store.state.paiements.indexOf(t),a=this.$store.state.commandes.find((e=>e.id==t.commande_id)),i=this.$store.state.dettes.find((e=>e.id==t.commande_id));a&&(a.uncommited-=t.somme),i&&(i.uncommited-=t.somme),this.$store.state.paiements.splice(s,1)})).catch((t=>{console.error(t)}))},validatePay(t){if(confirm("avez-vous vraiment recu l'argent liquide?")){let e={validated:!0};n().patch(this.$store.state.url+`/paiement/${t.id}/`,e,this.headers).then((e=>{let s=this.$store.state.paiements.indexOf(t),a=this.$store.state.commandes.find((e=>e.id==t.commande_id)),i=this.$store.state.dettes.find((e=>e.id==t.commande_id));if(a&&(a.payee+=t.somme,a.uncommited-=t.somme),i)if(i.reste-=t.somme,i.reste<=0){let t=this.$store.state.dettes.indexOf(i);this.$store.state.dettes.splice(t,1)}else i.payee+=t.somme,i.uncommited-=t.somme;this.$store.state.paiements.splice(s,1)})).catch((t=>{console.error(t)}))}},validateAllPay(){},fetchPayements(){n().get(this.$store.state.url+"/paiement/",this.headers).then((t=>{this.$store.state.paiements=t.data,this.paiements=t.data})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};n().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,headers.headers.Authorization="Bearer "+t.data.access})).catch((t=>{console.error(t)}))}}))}},mounted(){0==this.paiements.length&&this.fetchPayements()}},ma=pa,va=(0,h.Z)(ma,ua,ha,!1,null,"58ced1b9",null),_a=va.exports,fa=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table pertes"},[t._m(0),e("tbody",{attrs:{id:"pertes"}},t._l(t.pertes,(function(s){return s.validated?t._e():e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.prix_vente*s.quantite)))]),e("td",[t._v(t._s(s.details))]),t.userIs("admin")?e("td",[e("button",{on:{click:function(e){return t.acceptPerte(s)}}},[t._v("Accepter")]),e("button",{on:{click:function(e){return t.deletePerte(s)}}},[t._v("Refuser")])]):t._e()])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th",[e("button",{on:{click:function(e){t.perte_shown=!0}}},[t._v("ajouter")])]),t.userIs("admin")?e("th",[e("button",[t._v("Tout accepter")]),e("button",[t._v("Tout refuser")])]):t._e()])])])]),e("PerteDialog",{attrs:{visible:t.perte_shown},on:{"update:visible":function(e){t.perte_shown=e},close:function(e){t.perte_shown=!1},added:t.pushPerte}})],1)},ga=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("date")]),e("th",[t._v("quantité perdu")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("motif")]),e("th")])])}],ba=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()},keydown:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Perte")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du produit")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nom_produit,expression:"nom_produit"}],attrs:{type:"text",list:"noms"},domProps:{value:t.nom_produit},on:{input:function(e){e.target.composing||(t.nom_produit=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_quantite"}},[t._v("Quantité")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.quantite,expression:"quantite"}],attrs:{type:"number"},domProps:{value:t.quantite},on:{input:function(e){e.target.composing||(t.quantite=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Détails")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.details,expression:"details"}],attrs:{list:"tels"},domProps:{value:t.details},on:{input:function(e){e.target.composing||(t.details=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Soumettre"},on:{click:t.postPerte}})])]),e("datalist",{attrs:{id:"noms"}},t._l(t.produits,(function(t){return e("option",{domProps:{value:t.nom}})})),0)],1)])},ya=[],Ca={props:{visible:{type:Boolean,default:!1}},data(){return{logs:"",nom_produit:"",quantite:0,details:""}},computed:{produits(){return this.$store.state.produits}},methods:{close(){this.$emit("close")},postPerte(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=this.$store.state.produits.find((t=>t.nom==this.nom_produit)),s={produit:e.id,quantite:this.quantite,details:this.details};s.quantite<=0?this.logs="cette quantité est invalide":s.details.length<7?this.logs="vous devez donner un justification valide":n().post(this.$store.state.url+"/perte/",s,t).then((t=>{this.$emit("added",t.data),e.quantite-=t.data.quantite,this.close()})).catch((t=>{t.response?this.logs=t.response.data.status:(this.logs="une erreur est survenue",console.error(t))}))}}},$a=Ca,wa=(0,h.Z)($a,ba,ya,!1,null,"c0464c96",null),xa=wa.exports,qa={components:{SearchBar:O,PerteDialog:xa},data(){return{pertes:[],perte_shown:!1}},computed:{total(){let t=0;if(0==this.pertes.length)return t;for(let e of this.pertes)e.validated||(t+=e.prix_vente*e.quantite);return t},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{userIs(t){return this.$store.state.user.groups.includes(t)},searchItem(t){let e=this.$store.state.pertes.filter((e=>e.id==t|e.produit.toLowerCase().includes(t.toLowerCase())));this.pertes=e},pushPerte(t){this.pertes.push(t)},acceptPerte(t){if(confirm("Acceptez-vous vraiment cette perte?")){console.log("triggered");let e={validated:!0};n().patch(this.$store.state.url+`/perte/${t.id}/`,e,this.headers).then((e=>{t.validated=!0})).catch((t=>{console.error(t)}))}},deletePerte(t){if(confirm("Etes vous sur de supprimer cette perte?\nNB: Si vous supprimez cette perte, sa quantité sera réajoutée dans le stock")){n()["delete"](this.$store.state.url+`/perte/${t.id}/`,this.headers).then((e=>{this.pertes.splice(this.pertes.indexOf(t),1),this.$store.state.produits.find((e=>e.id==t.produit_id)).quantite+=t.quantite})).catch((t=>{console.error(t)}))}}},mounted(){n().get(this.$store.state.url+"/perte/",this.headers).then((t=>{this.$store.state.pertes=t.data,this.pertes=t.data})).catch((t=>{console.error(t)}))}},ka=qa,Pa=(0,h.Z)(ka,fa,ga,!1,null,"26799ea6",null),Da=Pa.exports,Sa=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table users"},[t._m(0),e("tbody",{attrs:{id:"users"}},t._l(t.users,(function(s,a){return e("tr",[e("td",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.username))]),e("td",[t._v(t._s(s.first_name))]),e("td",[t._v(t._s(s.last_name))]),e("td",[t._v(t._s(s.is_active))]),e("td",{staticClass:"groups"},t._l(s.groups,(function(s){return e("span",[t._v(" "+t._s(s)),e("span",{staticClass:"comma"},[t._v(",")])])})),0),e("td",[e("div",{staticClass:"btns"},[t.permited(s)?e("button",{on:{click:function(e){return t.editUser(s)}}},[t._v(" editer ")]):t._e(),t.editable(s)?e("span",[s.is_active?e("button",{on:{click:function(e){return t.deactivateUser(s)}}},[t._v("desactiver")]):e("button",{on:{click:function(e){return t.activateUser(s)}}},[t._v("activer")])]):t._e()])]),e("td")])})),0)])]),e("EditUser",{attrs:{visible:t.edit_mode,item:t.active_user},on:{close:t.exitEdition}})],1)},Ba=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("#")]),e("th",[t._v("username")]),e("th",[t._v("prenom")]),e("th",[t._v("nom")]),e("th",[t._v("actif")]),e("th",[t._v("groupes")]),e("th",[t._v("options")]),e("th",[e("button",[t._v("Ajouter")])])])])}],Aa=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("div",{staticClass:"head"},[e("h3",[t._v("Modifier Utilisateur")]),e("button",{staticClass:"close",on:{click:t.close}},[t._v("x")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_username"}},[t._v("Username:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.username,expression:"new_user.username"}],attrs:{type:"text",id:"id_username"},domProps:{value:t.new_user.username},on:{input:function(e){e.target.composing||t.$set(t.new_user,"username",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_first_name"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.first_name,expression:"new_user.first_name"}],attrs:{type:"text",id:"id_first_name"},domProps:{value:t.new_user.first_name},on:{input:function(e){e.target.composing||t.$set(t.new_user,"first_name",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_last_name"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.last_name,expression:"new_user.last_name"}],attrs:{type:"text",id:"id_last_name"},domProps:{value:t.new_user.last_name},on:{input:function(e){e.target.composing||t.$set(t.new_user,"last_name",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_first_name"}},[t._v(" Mot de passe: ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.password,expression:"new_user.password"}],attrs:{type:"password",id:"id_psswd"},domProps:{value:t.new_user.password},on:{input:function(e){e.target.composing||t.$set(t.new_user,"password",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"confirm"}},[t._v(" confirmation: ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.confirm,expression:"confirm"}],attrs:{type:"password",id:"confirm"},domProps:{value:t.confirm},on:{input:function(e){e.target.composing||(t.confirm=e.target.value)}}})]),t.is_admin?e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_group"}},[t._v("Groupe:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.group,expression:"group"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.group=e.target.multiple?s:s[0]}}},t._l(t.groups,(function(s){return e("option",{domProps:{selected:t.user.groups.includes(s),value:s}},[t._v(" "+t._s(s)+" ")])})),0)]):t._e(),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerUser}})])])])])},Na=[],Oa={props:{visible:{type:Boolean,default:!1},item:{type:Object,required:!0}},data(){return{logs:"",new_user:{},group:"",groups:["admin","gestionnaire","agent"],confirm:""}},computed:{is_admin(){return this.$store.state.user.is_admin}},watch:{item(t){this.new_user=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerUser(){let t={username:this.new_user.username,first_name:this.new_user.first_name,last_name:this.new_user.last_name};if(this.group&&(t["group"]=this.group),this.new_user.password){if(this.new_user.password!=this.confirm)return void(this.logs="les mot de passes doivent être identiques");if(this.new_user.password.length<6)return void(this.logs="le mot de passe doit avoir au moins 6 caractères");t["password"]=this.new_user.password}let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};n().put(this.$store.state.url+`/user/${this.item.id}/`,t,e).then((t=>{Object.assign(this.item,t.data),this.$emit("close")})).catch((t=>{console.error(t)}))}}},Ta=Oa,La=(0,h.Z)(Ta,Aa,Na,!1,null,"8c507118",null),Ia=La.exports,Ea={components:{SearchBar:O,EditUser:Ia},data(){return{query_date:!1,edit_mode:!1,users:this.$store.state.users,details_opened:!1,active_user:{groups:[]}}},computed:{},methods:{editable(t){return this.$store.state.user.is_admin&&t.id!=this.$store.state.user.id},permited(t){return this.$store.state.user.is_admin||this.$store.state.user.id==t.id},searchItem(t){let e={};if(""==t)return this.fetchData();e=this.query_date||""==t?this.users.filter((e=>e.id==t|e.client.toLowerCase().includes(t.toLowerCase()))):this.$store.state.users.filter((e=>e.id==t|e.client.toLowerCase().includes(t.toLowerCase()))),this.users=e},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&n().get(this.$store.state.url+"/user/",t).then((t=>{this.$store.state.users=t.data.results,this.users=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}},deactivateUser(t){confirm("voulez-vous vraiment arreter cette utilisateur?")&&n().put(this.$store.state.url+`/user/${t.id}/`,{is_active:!1},this.headers()).then((e=>{Object.assign(t,e.data)})).catch((t=>{console.error(t)}))},activateUser(t){confirm("voulez-vous mettre cette utilisateur en action?")&&n().put(this.$store.state.url+`/user/${t.id}/`,{is_active:!0},this.headers()).then((e=>{Object.assign(t,e.data)})).catch((t=>{console.error(t)}))},exitEdition(t){this.edit_mode=!1},editUser(t){this.edit_mode=!0,this.active_user=t}},mounted(){this.fetchData()}},Fa=Ea,za=(0,h.Z)(Fa,Sa,Ba,!1,null,"12758f30",null),Za=za.exports;a.ZP.use(q.ZP);const ja=[{path:"/",name:"",component:gt},{path:"/home",name:"home",component:gt},{path:"/stock/produit",name:"produit",component:re},{path:"/stock/salle",name:"salle",component:Se},{path:"/stock/oeuf",name:"oeuf",component:Me},{path:"/hist/oeuf_vendu",name:"oeuf_vendu",component:Ws},{path:"/hist/achats",name:"achats",component:Ds},{path:"/hist/rations",name:"rations",component:Zs},{path:"/hist/paiements",name:"paiements",component:_a},{path:"/stats/product",name:"statsoeuf",component:Qs},{path:"/stats/clients",name:"statsclients",component:ia},{path:"/stats/pertes",name:"statspertes",component:ca},{path:"/pertes",name:"pertes",component:Da},{path:"/users",name:"users",component:Za},{path:"/transactions",name:"transactions",component:$s}],Ua=new q.ZP({mode:"history",base:"/",routes:ja});var Ra=Ua,Va=s(408);a.ZP.use(Va.ZP);var Ja=new Va.ZP.Store({state:{user:null,clients:[],url:"/api",produits:[],salles:[],stats:[],oeufs:[],oeufs_vendus:[],achats:[],transactions:[],responsables:[],pertes:[],commandes:[],prix:[],rations:[],users:[],dettes:[],achats_fetched:!1,dettes_fetched:!1,commandes_fetched:!1,cart:new Object({content:[],getTotal(){let t=0;for(let e=0;e<this.content.length;e++)t+=this.content[e].getTotal();return t},getLength(){return this.content.length},find(t){for(let e=0;e<this.content.length;e++){let s=this.content[e];if(s.product.id==t)return e}return-1},getQuantite(t){let e=this.find(t);return e>=0?this.content[e].quantite:0},increase(t){let e=this.find(t);if(e>=0){let t=this.content[e];t.quantite<t.product.quantite&&t.quantite++}},decrease(t){let e=this.find(t);if(e>=0){let t=this.content[e];t.quantite>1?t.quantite--:this.content.splice(e,1)}},add(t,e){if(0==t.quantite)return;let s=this.find(t.id);if(s>=0)e&&t.quantite>e?this.content[s].quantite=e:this.increase(t.id);else{let s=new Object({product:t,quantite:e||1,getTotal(){return this.product.prix_unitaire*this.quantite}});this.content.push(s)}}})},mutations:{},actions:{},modules:{}}),Qa=s(7979),Ma=s(9946),Ga=s(4984),Ha=s(1590),Ka=s.n(Ha);a.ZP.use(Ka()),Qa.vI.add(Ma.sq$,Ma.IA$,Ma.FVb,Ma.koM,Ma.IwR,Ma.I7k,Ma.LEp,Ma.oFW,Ma.oTz,Ma.q7m,Ma.cf$),a.ZP.component("fa",Ga.GN),a.ZP.mixin({methods:{money(t){return void 0==t||null==t?"-":t.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},datetime(t){if(!t)return"-";let e=new Date(t);return new Intl.DateTimeFormat("en-GB",{dateStyle:"short",timeStyle:"short"}).format(e)},userIs(t){return this.user.groups.includes(t)}},computed:{user(){return this.$store.state.user}}}),a.ZP.config.productionTip=!1,new a.ZP({router:Ra,store:Ja,render:t=>t(x)}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,s),r.exports}s.m=t,function(){var t=[];s.O=function(e,a,i,r){if(!a){var o=1/0;for(c=0;c<t.length;c++){a=t[c][0],i=t[c][1],r=t[c][2];for(var n=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(s.O).every((function(t){return s.O[t](a[l])}))?a.splice(l--,1):(n=!1,r<o&&(o=r));if(n){t.splice(c--,1);var d=i();void 0!==d&&(e=d)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[a,i,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,r,o=a[0],n=a[1],l=a[2],d=0;if(o.some((function(e){return 0!==t[e]}))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var c=l(s)}for(e&&e(a);d<o.length;d++)r=o[d],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(c)},a=self["webpackChunkinkoko_ui"]=self["webpackChunkinkoko_ui"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(5116)}));a=s.O(a)})();
//# sourceMappingURL=app.70d3eb67.js.map