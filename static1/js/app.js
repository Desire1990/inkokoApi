(function(){"use strict";var t={8839:function(t,e,s){var a,i,r=s(7195),o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"body"}},[e("meta",{attrs:{name:"viewport",content:"width=device-width, initial-scale=1.0"}}),t.logged_in?e("div",{staticClass:"main"},[e("NavBar"),e("router-view"),e("div",{staticClass:"loggout",on:{click:t.loggout}},[e("fa",{attrs:{icon:"power-off"}})],1)],1):e("div",[e("Login")],1)])},n=[],l=s(8428),d=s.n(l),c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"centered"},[e("form",{attrs:{action:".",method:"post"}},[e("center",[e("h2",{staticStyle:{"text-transform":"uppercase"}},[t._v("chicken breeding")]),e("img",{attrs:{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE0Xu_rtvk8mygc60iDSxns0rxJh2cJs7gzA&usqp=CAU",alt:"",width:"100%",height:"50%"}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_username"}},[t._v("Username:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],attrs:{type:"text",name:"username",placeholder:"Username ",required:"",id:"id_username",autocomplete:"on"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_password"}},[t._v("Password:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],attrs:{type:"password",name:"password",placeholder:"Password ",required:"",id:"id_password",autocomplete:"on"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),t.logs.length>0?e("label",{staticStyle:{color:"red"},attrs:{for:"id_password"}},[t._v(t._s(t.logs)+" ")]):t._e(),e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.logIn.apply(null,arguments)}}},[t._v("Log In")])]),e("center",[t._v(" Developped by "),e("b",[e("a",{attrs:{href:"https://github.com/Desire1990"}},[t._v("Desos")])])])],1)])},u=[],h={data(){return{logs:"",username:"",password:"",url:this.$store.state.url}},methods:{logIn(){this.logs="loging in...",d().post(this.url+"/login/",{username:this.username,password:this.password}).then((t=>{this.$store.state.user=t.data})).catch((t=>{t.response?this.logs=JSON.stringify(t.response.data):this.logs="erreur de connectivité"}))}}},p=h,m=s(1001),v=(0,m.Z)(p,c,u,!1,null,"c79e1af0",null),_=v.exports,f=function(){var t=this,e=t._self._c;return e("center",{staticClass:"parent"},[e("img",{attrs:{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE0Xu_rtvk8mygc60iDSxns0rxJh2cJs7gzA&usqp=CAU",alt:"",width:"100px",height:"50px"}}),e("router-link",{attrs:{to:"/home",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"shopping-cart"}})],1),t._v(" HOME "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"ration"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Ration ")],1),e("router-link",{attrs:{to:{name:"oeufs"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs ")],1),e("router-link",{attrs:{to:{name:"poulet"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Poulet ")],1)],1)]),e("router-link",{attrs:{to:"/stock",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" STOCK "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"produit"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Produits ")],1),e("router-link",{attrs:{to:{name:"salle"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Salle ")],1),e("router-link",{attrs:{to:{name:"oeuf"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs ")],1)],1)]),e("router-link",{attrs:{to:"/hist",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" HISTORIQUES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"achats"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Achats ")],1),e("router-link",{attrs:{to:{name:"rations"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Rations ")],1),e("router-link",{attrs:{to:{name:"dettes"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Dettes ")],1),e("router-link",{attrs:{to:{name:"paiements"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),e("span",[t._v("Paiements")])],1)],1)]),t.is_admin||t.userIs("gerant")?e("router-link",{attrs:{to:"/stats",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"chart-bar"}})],1),t._v(" STATISTIQUES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"statsproduct"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Produits ")],1),e("router-link",{attrs:{to:{name:"statsoeuf"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Oeufs ")],1),e("router-link",{attrs:{to:{name:"statsclients"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Clientèles ")],1),e("router-link",{attrs:{to:{name:"statspertes"}}},[e("fa",{attrs:{icon:"chart-bar"}}),t._v(" Pertes ")],1)],1)]):t._e(),e("router-link",{attrs:{to:"/pertes",event:""},nativeOn:{mouseenter:function(e){return(e=>t.showSubmenu(e)).apply(null,arguments)},mouseleave:function(e){return(e=>t.hideSubmenu(e)).apply(null,arguments)}}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"trash-alt"}})],1),t._v(" PERTES "),e("div",{staticClass:"submenu"},[e("router-link",{attrs:{to:{name:"produit"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Poules ")],1),e("router-link",{attrs:{to:{name:"oeuf"}}},[e("fa",{attrs:{icon:"hand-holding-usd"}}),t._v(" Oeufs ")],1)],1)]),t.$store.state.user.groups.includes("admin")?e("router-link",{attrs:{to:"/users"}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"users"}})],1),t._v(" UTILISATEURS ")]):t._e(),e("router-link",{attrs:{to:"/transactions"}},[e("div",{staticClass:"icon"},[e("fa",{attrs:{icon:"hand-holding-usd"}})],1),t._v(" TRANSACTIONS ")]),e("br"),e("br"),e("br"),e("div",[e("h2",[t._v(t._s(this.user.username))])])],1)},g=[],b={computed:{is_admin(){return this.$store.state.user.is_admin}},methods:{showSubmenu(t){let e=t.target.getElementsByClassName("submenu")[0];e.style.display="block"},hideSubmenu(t){let e=t.target.getElementsByClassName("submenu")[0];e.style.display="none"}}},y=b,C=(0,m.Z)(y,f,g,!1,null,"7a22158f",null),w=C.exports,$={components:{NavBar:w,Login:_},computed:{logged_in(){return null!=this.$store.state.user}},mounted(){var t=JSON.parse(localStorage.getItem("user"));t?this.$store.state.user=t:console.warn("il y'a pas de session"),0==this.$store.state.produits.length&&this.fetchProducts()},watch:{"$store.state.user":{deep:!0,handler(t){localStorage.setItem("user",JSON.stringify(t))}}},methods:{loggout(){confirm("êtes vous sur de vouloir deconnecter?")&&(this.$store.state.user=null)},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data,this.items=t.data})).catch((t=>{console.error(t)}))}}},x=$,q=(0,m.Z)(x,o,n,!1,null,null,null),k=q.exports,D=s(2241),P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])])],1)},S=[],A=function(){var t=this,e=t._self._c;return e("div",{staticClass:"center"},[e("button",{staticClass:"change red",on:{click:function(e){return t.changeColor("red")}}}),e("button",{staticClass:"change green",on:{click:function(e){return t.changeColor("green")}}}),e("button",{staticClass:"change blue",on:{click:function(e){return t.changeColor("blue")}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{type:"text",placeholder:"Keyword",id:"id_username",autofocus:""},domProps:{value:t.keyword},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.keyword=e.target.value)}}}),e("button",{attrs:{type:"reset"},on:{click:function(e){t.keyword=""}}},[t._v("×")]),t.show_date?e("div",{staticStyle:{display:"inline"}},[e("button",{staticStyle:{"margin-left":"0"},on:{click:function(e){t.triggered=!t.triggered}}},[t._v(" Date ")]),t.triggered?e("div",{staticClass:"form"},[e("label",[t._v("Du:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.date.du,expression:"date.du"}],attrs:{type:"date",name:"date_du"},domProps:{value:t.date.du},on:{input:function(e){e.target.composing||t.$set(t.date,"du",e.target.value)}}}),e("label",[t._v("Au:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.date.au,expression:"date.au"}],attrs:{type:"date",name:"date_au"},domProps:{value:t.date.au},on:{input:function(e){e.target.composing||t.$set(t.date,"au",e.target.value)}}}),e("input",{staticStyle:{border:"1px solid black"},attrs:{type:"submit",value:"search"},on:{click:t.performSearch}})]):t._e()]):t._e()])},B=[],N={props:{show_date:{type:Boolean,default:!0}},components:{},data(){return{keyword:"",date:{du:null,au:null},triggered:!1}},watch:{keyword(t){this.$emit("searched",t)}},methods:{performSearch(){this.triggered=!1,this.$emit("changed",this.date)},changeColor(t){"red"==t&&(document.documentElement.style.setProperty("--primary","#d55"),document.documentElement.style.setProperty("--primary-light","#faa"),document.documentElement.style.setProperty("--hover","#faa")),"green"==t&&(document.documentElement.style.setProperty("--primary","green"),document.documentElement.style.setProperty("--primary-light","#595"),document.documentElement.style.setProperty("--hover","#595")),"blue"==t&&(document.documentElement.style.setProperty("--primary","#08a"),document.documentElement.style.setProperty("--primary-light","lightblue"),document.documentElement.style.setProperty("--hover","#29b"))}}},I=N,O=(0,m.Z)(I,A,B,!1,null,"37f2c6a2",null),T=O.exports,F=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" "+t._s(t.item.salle.nom))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(t.item.prix.prix))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite)+" oeufs ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},L=[],E={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},z=E,Z=(0,m.Z)(z,F,L,!1,null,"b14f4d78",null),j=Z.exports,U={},R=(0,m.Z)(U,a,i,!1,null,null,null),V=R.exports,J=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()},keydown:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Paiement")])]),e("form",{attrs:{method:"post"}},[e("div",[t._v(" La somme à payer "),e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v("Fbu ")]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_somme"}},[t._v("La somme payée")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.payee,expression:"payee"}],attrs:{type:"number",id:"id_somme"},domProps:{value:t.payee},on:{input:function(e){e.target.composing||(t.payee=e.target.value)}}})]),e("div",[t._v(" La somme à lui retourner "),e("b",[t._v(t._s(t.money(t.payee-t.cart.getTotal())))]),t._v("Fbu ")]),e("hr"),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du client")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.client.nom,expression:"client.nom"}],attrs:{type:"text",list:"noms",id:"id_nom"},domProps:{value:t.client.nom},on:{change:t.setTel,input:function(e){e.target.composing||t.$set(t.client,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Téléphone")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.client.tel,expression:"client.tel"}],attrs:{type:"number",id:"id_tel",list:"tels"},domProps:{value:t.client.tel},on:{change:t.setNom,input:function(e){e.target.composing||t.$set(t.client,"tel",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Vendre"},on:{click:t.postCommande}})])]),e("datalist",{attrs:{id:"noms"}},t._l(t.clients,(function(t){return e("option",{domProps:{value:t.nom}})})),0),e("datalist",{attrs:{id:"tels"}},t._l(t.clients,(function(t){return e("option",{domProps:{value:t.tel}})})),0)],1)])},Q=[],M=(s(541),{props:{visible:{type:Boolean,default:!1}},data(){return{client:{nom:"",tel:""},cart:this.$store.state.cart,dette_p:null,logs:""}},computed:{payee:{get(){return null==this.dette_p?this.cart.getTotal():this.dette_p},set(t){this.dette_p=t}},clients(){return this.$store.state.clients},host(){return this.$store.state.url},username(){return this.$store.state.user.username},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},mounted(){this.clients.length<1&&d().get(this.$store.state.url+"/client/",this.headers).then((t=>{this.$store.state.clients=t.data})).catch((t=>{}))},methods:{close(){this.$emit("close")},setTel(){for(let t of this.clients)if(t.nom==this.client.nom)return void(this.client.tel=t.tel)},setNom(){for(let t of this.clients)if(t.tel==this.client.tel)return void(this.client.nom=t.nom)},postCommande(){if(this.payee<this.cart.getTotal()&&this.client.tel.length<7)return void(this.logs="le numero est obligatoire pour les dettes");let t={},e=[],s=this.cart.getTotal(),a=this.payee<=s?this.payee:s,i=this.payee==this.cart.getTotal();for(let r of this.cart.content)e.unshift({id:r.product.id,quantite:r.quantite});t={items:e,client:this.client,payee:a,validated:i,a_payer:s},d().post(this.$store.state.url+"/commande/",t,this.headers).then((t=>{let s,a=t.data,i=this.templateFacture(this.cart.content,a.id),r=this.$store.state.produits;this.client={nom:"",tel:""},this.$store.state.cart.content=[],this.$store.state.commandes.unshift(a);for(let o of e)s=r.find((t=>t.id==o.id)),s&&(s.quantite-=o.quantite);a.reste>0&&this.$store.state.dettes.unshift(a),this.$emit("close"),this.printDiv(i)})).catch((t=>{t.response?this.logs=t.response.data.status:(this.logs="une erreur est survenue",console.error(t))}))},printDiv(t){var e=window.open("","","height=500, width=1000");e.document.write(t),e.document.close(),setTimeout((function(){e.print(),e.close()}),1e3)},templateFacture(t,e){let s="";for(let i of t)s+=`\n          <tr style="text-align: left;">\n            <td>${i.product.nom}</td>\n            <td>${i.product.prix_vente} Fbu</td>\n            <td>x ${i.quantite}</td>\n            <td style="text-align: right;">${i.getTotal()} Fbu</td>\n          </tr>\n        `;let a=`\n      <table style="width:100%;">\n        <tr>\n          <td>\n            Facture no. ${e} du ${new Intl.DateTimeFormat("en-GB",{dateStyle:"short",timeStyle:"short"}).format(new Date)}<br>\n          </td>\n        </tr>\n        <tr style="display: inline;">\n          <td>\n            <img width=100px src="/static/img/bimbo.png"/>\n          </td>\n          <td>\n            RC 23606/20<br/>\n            NIF 4001409707<br/>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            Tel: 61 977 004 / 71 369 548<br/>\n            BIMBO General Trading (BGT)<br/>\n            Bujumbura, Gihosha<br/><br/>\n          </td>\n        </tr>\n        <tr>\n          <td><b>${this.client.nom}: ${this.client.tel}</b></td>\n        </tr>\n        <tr>\n        <td>\n      </table>\n        <table style="width:100%;">\n          <tbody>\n            <tr style="border-bottom: 1px solid #aaa;text-align: left;">\n              <th>Article</th>\n              <th style="">P.U.</th>\n              <th>Qt.</th>\n              <th style="text-align: right;">Total</th>\n            </tr>\n            ${s}\n            <tr style="border-top: 1px solid #aaa;text-align: left;">\n              <th colspan="3">Total</th>\n              <th style="text-align: right;"><b>${this.cart.getTotal()} Fbu</b></th>\n            </tr>\n          </tbody>\n        </table>\n        </td>\n        </tr>\n        <tr>\n        <td>Caissier ${this.username}</td>\n        </tr>\n        <tr>\n        <br>\n        <td style="text-align: center;"><strong>Murakoze, Merci, Thank you!</strong></td>\n        </tr>\n        `;return a}}}),G=M,H=(0,m.Z)(G,J,Q,!1,null,"aaf52a4c",null),K=H.exports,X={components:{SearchBar:T,Item:j,CartItem:V,DialogSubmit:K},data(){return{items:this.$store.state.oeufs,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite>0))},empty_items(){return this.items.filter((t=>0==t.quantite))}},methods:{performFilter(t){let e=this.$store.state.oeufs.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/oeuf/",t).then((t=>{this.$store.state.oeufs=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.oeufs.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home/ration"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.oeufs)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},W=X,Y=(0,m.Z)(W,P,S,!1,null,null,null),tt=Y.exports,et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])])],1)},st=[],at=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" "+t._s(t.item.designation))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(t.item.prix_unitaire))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite)+" "+t._s(t.item.unite)+" ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},it=[],rt={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},ot=rt,nt=(0,m.Z)(ot,at,it,!1,null,"8ed8b9a6",null),lt=nt.exports,dt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.decrease(t.item.product.id)}}},[t._v("- ")]),e("button",{staticClass:"cart_button",on:{click:function(e){return t.cart.increase(t.item.product.id)}}},[t._v("+ ")]),e("div",{staticClass:"cart_body"},[e("div",[e("b",[t._v(t._s(t.item.quantite))]),t._v(" x "+t._s(t.item.product.designation)+" "),e("fa",{staticStyle:{color:"#b55"},attrs:{icon:"trash-alt"},on:{click:function(e){return t.remove(t.item)}}})],1),e("div",[e("b",[t._v(t._s(t.money(t.item.getTotal())))]),t._v(" Fbu ")])])])},ct=[],ut={props:{item:{type:Object,required:!0}},computed:{cart(){return this.$store.state.cart}},methods:{remove(t){let e=this.cart.find(t.product.id);this.cart.content.splice(e,1)}}},ht=ut,pt=(0,m.Z)(ht,dt,ct,!1,null,"5dc58499",null),mt=pt.exports,vt={components:{SearchBar:T,Item:lt,CartItem:mt,DialogSubmit:K},data(){return{items:this.$store.state.produits,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite>0))},empty_items(){return this.items.filter((t=>0==t.quantite))}},methods:{performFilter(t){let e=this.$store.state.produits.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.produits.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home/ration"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.produits)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},_t=vt,ft=(0,m.Z)(_t,et,st,!1,null,null,null),gt=ft.exports,bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}}),e("div",{staticClass:"page"},[e("div",{staticClass:"items"},[e("div",{staticClass:"recycler"},t._l(t.non_empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1),e("hr",{staticStyle:{margin:"20px 0"}}),e("div",{staticClass:"recycler"},t._l(t.empty_items,(function(t){return e("Item",{key:t.id,attrs:{item:t}})})),1)]),t.panier_shown?e("div",{staticClass:"cart"},[e("span",{staticClass:"close_panier",on:{click:function(e){t.panier_shown=!1}}},[t._v("x")]),e("h3",{staticClass:"title"},[t._v("Panier")]),e("div",{staticClass:"panier_items"},t._l(t.cart.content,(function(t){return e("CartItem",{key:t.id,attrs:{item:t}})})),1),e("div",{staticClass:"totals"},[e("div",[t._v(" Total ")]),e("div",[e("b",[t._v(t._s(t.money(t.cart.getTotal())))]),t._v(" Fbu")])]),t.cart.getLength()?e("div",{staticClass:"cart_buttons"},[e("button",{on:{click:function(e){t.cart.content=[]}}},[t._v("reset")]),e("button",{on:{click:function(e){t.confirm_vente=!0}}},[t._v("valider")])]):t._e()]):e("div",{staticClass:"btn_panier",on:{click:function(e){t.panier_shown=!0}}},[t._v(" panier("+t._s(t.cart.getLength())+") ")])])],1)},yt=[],Ct=function(){var t=this,e=t._self._c;return e("div",{class:{parent:!0,danger:0==t.item.quantite},attrs:{"data-id":t.item.id}},[e("div",{staticStyle:{"flex-grow":"1"}},[e("span",{staticClass:"name"},[t._v(" Salle "+t._s(t.item.nom))]),e("div",{staticClass:"prix"},[t._v(" "+t._s(t.money(t.item.prix.prix))+" Fbu")])]),e("div",{staticClass:"qtt"},[t._v(" quantité dispo: "),e("span",{staticClass:"dispo"},[t._v(" "+t._s(t.item.quantite)+" poulets ")])]),e("div",{staticClass:"buttons"},[e("button",{staticClass:"bg-blue",on:{click:t.decreaseQtt}},[t._v("-")]),t.editable?e("input",{directives:[{name:"model",rawName:"v-model",value:t.qtt,expression:"qtt"}],staticClass:"item_qtt",attrs:{type:"number",max:t.item.quantite},domProps:{value:t.qtt},on:{keydown:function(t){t.stopPropagation()},input:function(e){e.target.composing||(t.qtt=e.target.value)}}}):e("label",{on:{click:t.enableEdition}},[t._v(t._s(t.qtt))]),e("button",{staticClass:"bg-blue",on:{click:t.increaseQtt}},[t._v("+")])])])},wt=[],$t={props:{item:{type:Object,required:!0}},data(){return{cart:this.$store.state.cart,editable:!1}},methods:{getIcon(t){return null==t.image?"/img/item.png":t.image},increaseQtt:function(){this.cart.add(this.item)},decreaseQtt:function(){this.cart.decrease(this.item.id)},enableEdition(){0!=this.item.quantite&&(this.editable=!0)}},computed:{qtt:{get(){return this.cart.getQuantite(this.item.id)},set(t){0!=t.length&&this.cart.add(this.item,t)}}}},xt=$t,qt=(0,m.Z)(xt,Ct,wt,!1,null,"116523f0",null),kt=qt.exports,Dt={components:{SearchBar:T,Item:kt,CartItem:mt,DialogSubmit:K},data(){return{items:this.$store.state.salles,cart:this.$store.state.cart,panier_shown:!0,confirm_vente:!1,to_search:""}},computed:{non_empty_items(){return this.items.filter((t=>t.quantite>0))},empty_items(){return this.items.filter((t=>0==t.quantite))}},methods:{performFilter(t){let e=this.$store.state.salles.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchProducts(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/salle/",t).then((t=>{this.$store.state.salles=t.data.results,this.items=t.data.results})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchProducts()})).catch((t=>{this.$store.state.user=null}))}}))}},mounted(){this.$store.state.salles.length<1&&this.fetchProducts(),document.onkeydown=t=>{if("/home/ration"!==location.pathname)return;this.to_search+=t.key;let e=setTimeout((()=>{for(let t of this.$store.state.salles)if(t.id==this.to_search){this.cart.add(t);break}clearTimeout(e),this.to_search=""}),200)}}},Pt=Dt,St=(0,m.Z)(Pt,bt,yt,!1,null,null,null),At=St.exports,Bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("div",{staticClass:"btns"},[e("button",{on:{click:t.generateCSV}},[e("fa",{attrs:{icon:"download"}}),t._v(" Generer un model")],1),e("button",{on:{click:function(e){return e.preventDefault(),t.onPickFile.apply(null,arguments)}}},[e("fa",{attrs:{icon:"upload"}}),t._v(" Charger ")],1),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:"text/csv"},on:{change:t.uploadCSV}})]),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("nom")]),e("th",[t._v("quantite")]),e("th",[t._v("date")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("prix d'achat Total")]),e("th",[e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")])])])]),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("td",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.designation))]),e("td",[t._v(t._s(s.quantite)+" "+t._s(s.unite))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(t.money(s.prix_unitaire))+" Fbu")]),e("td",[t._v(t._s(t.money(s.prix_unitaire*s.quantite))+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]),e("button",{on:{click:function(e){return e.preventDefault(),t.startAchat(s)}}},[t._v("Acheter")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total()))+" Fbu")]),e("th")])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},Nt=[],It=(s(7658),function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"title"},[t._v(t._s(t.item.nom))]),e("div",[t._v(t._s(t.item.quantite)+" "+t._s(t.item.unite_sortant))]),e("div",{staticClass:"buttons"},[e("button",{on:{click:t.startEdit}},[t._v("Editer")]),e("button",{on:{click:t.startAchat}},[t._v("Acheter")])])])}),Ot=[],Tt={props:{item:{type:Object,required:!0}},methods:{startEdit(){this.$emit("edit")},startAchat(){this.$emit("achat")}}},Ft=Tt,Lt=(0,m.Z)(Ft,It,Ot,!1,null,"25cb0f8e",null),Et=Lt.exports,zt=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.designation))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.designation,expression:"new_produit.designation"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.designation},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"designation",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Unite d'achat:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.unite,expression:"new_produit.unite"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.unite},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"unite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Nouveau prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.prix_unitaire,expression:"new_produit.prix_unitaire"}],attrs:{type:"number",name:"prix",placeholder:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.prix_unitaire},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"prix_unitaire",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerPrix}})])])],1)])},Zt=[],jt={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerPrix(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().put(this.$store.state.url+`/produit/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.produits;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.produits[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},Ut=jt,Rt=(0,m.Z)(Ut,zt,Zt,!1,null,"185f37fc",null),Vt=Rt.exports,Jt=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ajouter un Produit")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.designation,expression:"produit.designation"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom du produit"},domProps:{value:t.produit.designation},on:{input:function(e){e.target.composing||t.$set(t.produit,"designation",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_entrant"}},[t._v("Unité d'achat:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.unite,expression:"produit.unite"}],attrs:{type:"text",id:"id_entrant",placeholder:"exemples: kg,carton,casier..."},domProps:{value:t.produit.unite},on:{input:function(e){e.target.composing||t.$set(t.produit,"unite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.produit.prix_unitaire,expression:"produit.prix_unitaire"}],attrs:{type:"number",name:"prix",placeholder:"prix unitaire",id:"id_prix"},domProps:{value:t.produit.prix_unitaire},on:{input:function(e){e.target.composing||t.$set(t.produit,"prix_unitaire",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{on:{click:function(e){return e.preventDefault(),t.generateCSV.apply(null,arguments)}}},[e("fa",{attrs:{icon:"download"}}),t._v(" Model ")],1),e("button",{on:{click:function(e){return e.preventDefault(),t.onPickFile.apply(null,arguments)}}},[e("fa",{attrs:{icon:"upload"}}),t._v(" Charger ")],1),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".csv"},on:{change:t.loadCSV}}),e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createProduct.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},Qt=[],Mt={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",produit:{},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" produits chargés",this.$refs.submit.innerText="upload"}},computed:{rapport(){let t="1 "+this.produit.unite+" vaut combien de "+this.produit.unite_sortant+"?";return this.produit.unite_sortant?t:"1 par defaut"},unite_sortant(){return this.produit.unite?this.produit.unite+" par defaut":"exemples: kg,carton,casier..."},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{close(){this.$emit("close")},uploadCSV(){d().post(this.$store.state.url+"/produit/",this.csv_array,this.headers).then((t=>{this.$store.state.produits=this.$store.state.produits.concat(t.data),this.csv_array=[],this.close()})).catch((t=>{console.error(t)}))},createProduct(){this.csv_array.length>0?this.uploadCSV():this.produit.designation?this.produit.unite?(this.produit.prix_achat||(this.produit.prix_achat=0,this.logs=""),d().post(this.$store.state.url+"/produit/",this.produit,this.headers).then((t=>{this.produit={},this.$store.state.produits.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))):this.logs="l'unité d'achat est obligatoire":this.logs="le nom est obligatoire"},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t='"sep=;"\nnom;unite;unite_sortant;rapport;prix_vente\n';this.download(t)},onPickFile(){this.$refs.fileInput.click()},loadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);this.csv_array=e}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].trim().split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].trim().split(";");for(let t=0;t<i.length;t++)r[a[t]]=i[t];s.push(r),r={}}return s}}},Gt=Mt,Ht=(0,m.Z)(Gt,Jt,Qt,!1,null,"aefe75a0",null),Kt=Ht.exports,Xt=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Augmenter "+t._s(t.produit.designation))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"inline_field"},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"lg_qtt"}},[t._v(t._s(t.produit.unite))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.lg_qtt,expression:"lg_qtt"}],attrs:{type:"number",id:"lg_qtt"},domProps:{value:t.lg_qtt},on:{input:function(e){e.target.composing||(t.lg_qtt=e.target.value)}}})])]),e("div",{class:{inline_field:1!=t.produit.rapport}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"prix"}},[t._v("Prix unitaire")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.prix,expression:"prix"}],ref:"prix",attrs:{type:"number",id:"prix"},domProps:{value:t.prix},on:{input:function(e){e.target.composing||(t.prix=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"total"}},[t._v("Prix total")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.total,expression:"total"}],ref:"total",attrs:{type:"number",id:"total"},domProps:{value:t.total},on:{input:function(e){e.target.composing||(t.total=e.target.value)}}})])]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Details:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.details,expression:"details"}],attrs:{name:"prix"},domProps:{value:t.details},on:{input:function(e){e.target.composing||(t.details=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"submit"},on:{click:t.submit}})])])],1)])},Wt=[],Yt={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0},achat:{type:Object,required:!1}},data(){return{payee:0,lg_qtt:0,total:0,logs:"",sm_qtt:0,prix:0,details:""}},computed:{qttTotal(){return this.lg_qtt},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},watch:{prix(t){this.$refs.prix==document.activeElement&&(this.total=t*this.qttTotal)},total(t){this.$refs.total==document.activeElement&&(this.prix=t/this.qttTotal)},achat(t){console.log(t),1==this.produit.rapport?this.lg_qtt=t.quantite:this.sm_qtt=t.quantite,this.total=t.prix_total}},methods:{close(){this.lg_qtt=0,this.sm_qtt=0,this.$emit("close")},submit(){this.achat?this.performEdition():this.performAchat()},performAchat(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,produit:this.produit.id},e=this.$store.state.url;d().post(e+"/achat/",t,this.headers).then((t=>{let e=this.$store.state.produits,s=e.find((t=>t.id==this.produit.id));this.$store.state.achats.unshift(t.data),s?(s.quantite+=t.data.quantite,this.$emit("close")):this.logs="quelque chose a mal tourné"})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))},performEdition(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,produit:this.produit.id},e=this.$store.state.url;d().put(e+`/achat/${this.achat.id}/`,t,this.headers).then((t=>{this.produit.quantite-=this.achat.quantite,this.achat.quantite=t.data.quantite,this.produit.quantite+=t.data.quantite,this.achat.prix_total=t.data.prix_total,this.achat.prix_unitaire=t.data.prix_unitaire,this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},te=Yt,ee=(0,m.Z)(te,Xt,Wt,!1,null,"f245b226",null),se=ee.exports,ae={components:{SearchBar:T,Item:Et,EditDialog:Vt,AchatDialog:se,ProduitDialog:Kt},data(){return{csvData:{},items:this.$store.state.produits,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.produits"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&d().get(this.$store.state.url+"/produit/",t).then((t=>{this.$store.state.produits=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.prix_unitaire*e.quantite;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.produits.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},ie=ae,re=(0,m.Z)(ie,Bt,Nt,!1,null,"380605ad",null),oe=re.exports,ne=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[e("thead",[e("tr",{staticClass:"panier-item",staticStyle:{"text-transform":"uppercase"}},[e("th",[t._v("id")]),e("th",[t._v("nom")]),e("th",[t._v("Type de poulle")]),e("th",[t._v("responsable")]),e("th",[t._v("Telephone")]),e("th",[t._v("quantite")]),e("th",[t._v("date")]),e("th",[e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")])])])]),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.nom))]),e("td",[t._v(t._s(s.type_poulle)+" ")]),e("td",[t._v(t._s(s.responsable.nom)+" "+t._s(s.responsable.prenom))]),e("td",[t._v(t._s(s.responsable.telephone)+" ")]),e("td",[t._v(t._s(s.quantite)+" poulles")]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]),e("button",{on:{click:function(e){return e.preventDefault(),t.startAchat(s)}}},[t._v("Oeuf")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total()))+" poulles")]),e("th"),e("th")])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},le=[],de=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.designation))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.designation,expression:"new_produit.designation"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.designation},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"designation",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Unite d'achat:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.unite,expression:"new_produit.unite"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.unite},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"unite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Nouveau prix:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.prix_unitaire,expression:"new_produit.prix_unitaire"}],attrs:{type:"number",name:"prix",placeholder:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.prix_unitaire},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"prix_unitaire",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerPrix}})])])],1)])},ce=[],ue={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerPrix(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().put(this.$store.state.url+`/produit/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.produits;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.produits[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},he=ue,pe=(0,m.Z)(he,de,ce,!1,null,"7b6def2a",null),me=pe.exports,ve=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Ajouter une Salle")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.salle.nom,expression:"salle.nom"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom du salle"},domProps:{value:t.salle.nom},on:{input:function(e){e.target.composing||t.$set(t.salle,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",[t._v("Selectionnez le type de poulle")]),e("br"),e("select",{directives:[{name:"model",rawName:"v-model",value:t.salle.type_poulle,expression:"salle.type_poulle"}],attrs:{type:"text",name:"cars_id",id:"id_entrant"},on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.salle,"type_poulle",e.target.multiple?s:s[0])}}},[e("option",[t._v("---- Selection d'une type ----")]),e("option",{attrs:{value:"poulet pondeuse"}},[t._v("Poulet pondeuse")]),e("option",{attrs:{value:"poulet en chair"}},[t._v("Poulet en chair")])])]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Quantite:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.salle.quantite,expression:"salle.quantite"}],attrs:{type:"text",id:"id_nom",placeholder:"le nombre de poulles"},domProps:{value:t.salle.quantite},on:{input:function(e){e.target.composing||t.$set(t.salle,"quantite",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"name"}},[t._v("Responsable:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedId,expression:"selectedId"}],attrs:{type:"text",id:"name",name:"example",list:"exampleList",placeholder:"Choisissez le responsable"},domProps:{value:t.selectedId},on:{input:function(e){e.target.composing||(t.selectedId=e.target.value)}}}),e("datalist",{attrs:{id:"exampleList"}},t._l(t.responsables,(function(t){return e("option",{key:t.id,domProps:{value:t.telephone}})})),0)]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{on:{click:function(e){return e.preventDefault(),t.generateCSV.apply(null,arguments)}}},[e("fa",{attrs:{icon:"download"}}),t._v(" Model ")],1),e("button",{on:{click:function(e){return e.preventDefault(),t.onPickFile.apply(null,arguments)}}},[e("fa",{attrs:{icon:"upload"}}),t._v(" Charger ")],1),e("input",{ref:"fileInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".csv"},on:{change:t.loadCSV}}),e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createProduct.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},_e=[],fe={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{form:{responsable:"",nom:"",quantite:"",type_poulle:""},logs:"",salle:{},selectedId:null,new_price:"",csv_array:[],responsables:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" produits chargés",this.$refs.submit.innerText="upload"}},computed:{rapport(){let t="1 "+this.produit.unite+" vaut combien de "+this.produit.unite_sortant+"?";return this.produit.unite_sortant?t:"1 par defaut"},unite_sortant(){return this.produit.unite?this.produit.unite+" par defaut":"exemples: kg,carton,casier..."},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},mounted(){d().get(this.$store.state.url+"/responsable/",this.headers).then((t=>{this.responsables=t.data.results,console.log(t.data)})).catch((t=>{console.error(t)}))},methods:{close(){this.$emit("close")},uploadCSV(){d().post(this.$store.state.url+"/produit/",this.csv_array,this.headers).then((t=>{this.$store.state.produits=this.$store.state.produits.concat(t.data),this.csv_array=[],this.close()})).catch((t=>{console.error(t)}))},createProduct(){d().post(this.$store.state.url+"/salle/",{responsable:this.selectedId,nom:this.salle.nom,type_poulle:this.salle.type_poulle,quantite:this.salle.quantite},this.headers).then((t=>{this.$store.state.salles.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t='"sep=;"\nnom;unite;unite_sortant;rapport;prix_vente\n';this.download(t)},onPickFile(){this.$refs.fileInput.click()},loadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);this.csv_array=e}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].trim().split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].trim().split(";");for(let t=0;t<i.length;t++)r[a[t]]=i[t];s.push(r),r={}}return s}}},ge=fe,be=(0,m.Z)(ge,ve,_e,!1,null,"40188e40",null),ye=be.exports,Ce=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Oeuf pondu")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Quantite:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.quantite,expression:"quantite"}],attrs:{name:"prix"},domProps:{value:t.quantite},on:{input:function(e){e.target.composing||(t.quantite=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Commentaire:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentaire,expression:"commentaire"}],attrs:{name:"prix"},domProps:{value:t.commentaire},on:{input:function(e){e.target.composing||(t.commentaire=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"submit"},on:{click:t.performAchat}})])])],1)])},we=[],$e={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0},achat:{type:Object,required:!1}},data(){return{payee:0,lg_qtt:0,total:0,logs:"",sm_qtt:0,prix:0,commentaire:"",quantite:0}},computed:{qttTotal(){return this.lg_qtt},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},watch:{prix(t){this.$refs.prix==document.activeElement&&(this.total=t*this.qttTotal)},total(t){this.$refs.total==document.activeElement&&(this.prix=t/this.qttTotal)},achat(t){console.log(t),1==this.produit.rapport?this.lg_qtt=t.quantite:this.sm_qtt=t.quantite,this.total=t.prix_total}},methods:{close(){this.lg_qtt=0,this.sm_qtt=0,this.$emit("close")},submit(){this.achat?this.performEdition():this.performAchat()},performAchat(){let t={commentaire:this.commentaire,quantite:this.quantite,salle:this.salle.id},e=this.$store.state.url;d().post(e+"/oeuf/",t,this.headers).then((t=>{let e=this.$store.state.salle,s=e.find((t=>t.id==this.salle.id));this.$store.state.achats.unshift(t.data),s?(s.quantite_oeuf+=t.data.quantite,this.$emit("close")):this.logs="quelque chose a mal tourné"})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))},performEdition(){let t={quantite:this.qttTotal,details:this.details,prix_total:this.total,produit:this.produit.id},e=this.$store.state.url;d().put(e+`/achat/${this.achat.id}/`,t,this.headers).then((t=>{this.produit.quantite-=this.achat.quantite,this.achat.quantite=t.data.quantite,this.produit.quantite+=t.data.quantite,this.achat.prix_total=t.data.prix_total,this.achat.prix_unitaire=t.data.prix_unitaire,this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},xe=$e,qe=(0,m.Z)(xe,Ce,we,!1,null,"78e57bc5",null),ke=qe.exports,De={components:{SearchBar:T,Item:Et,EditDialog:me,AchatDialog:ke,ProduitDialog:ye},data(){return{csvData:{},items:this.$store.state.salles,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.salles"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&d().get(this.$store.state.url+"/salle/",t).then((t=>{this.$store.state.salles=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.quantite;return t},totale(){let t=0;for(let e of this.items)t+=e.quantite_oeuf;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.salles.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())|e.type_poulle.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},Pe=De,Se=(0,m.Z)(Pe,ne,le,!1,null,"317c426a",null),Ae=Se.exports,Be=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[t._m(0),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.salle.nom))]),e("td",[t._v(t._s(s.prix.prix)+" Fbu")]),e("td",[t._v(t._s(s.quantite)+" oeufs")]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t.user.groups.includes("admin")||t.user.groups.includes("gerant")?e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]),e("button",{on:{click:function(e){return e.preventDefault(),t.startAchat(s)}}},[t._v("Acheter")])]):t._e()])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total()))+" oeufs")]),e("th"),e("th")])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},Ne=[function(){var t=this,e=t._self._c;return e("thead",{staticStyle:{"text-transform":"capitalize"}},[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("Salle")]),e("th",[t._v("prix")]),e("th",[t._v("quantite")]),e("th",[t._v("date")]),e("th")])])}],Ie={components:{SearchBar:T,Item:Et,EditDialog:Vt,AchatDialog:se,ProduitDialog:Kt},data(){return{csvData:{},items:this.$store.state.oeufs,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.oeufs"(t){this.items=t}},methods:{fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&d().get(this.$store.state.url+"/oeuf/",t).then((t=>{this.$store.state.oeufs=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)t+=e.quantite;return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},performFilter(t){let e=this.$store.state.oeufs.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())));this.items=e},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t=this.items,e="id;produit;quantite;prix_achat;details\n";for(var s=0;s<t.length;s++)e+=t[s].id+";"+t[s].nom+"\n";console.log(e),this.download(e)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()},uploadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{console.log(t),this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);console.log(e),console.table(e)}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].split(";");for(let t=0;t<i.length;t++)if(0===i.indexOf(i[t])||isNaN(i[t]))r[a[t]]=i[t];else{let e=Number.parseFloat(i[t]);r[a[t]]=e.toFixed(2)}s.push(r),r={}}return s}},mounted(){this.fetchData()}},Oe=Ie,Te=(0,m.Z)(Oe,Be,Ne,!1,null,"5313122a",null),Fe=Te.exports,Le=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table dettes"},[t._m(0),e("tbody",{attrs:{id:"dettes"}},t._l(t.dettes,(function(s){return e("tr",{class:{uncommited:s.uncommited>0}},[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.client))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.a_payer)+" Fbu")]),e("td",[t._v(t._s(s.payee+s.uncommited)+" Fbu")]),e("td",[t._v(t._s(s.reste-s.uncommited)+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[s.uncommited<s.reste?e("button",{on:{click:function(e){return t.rembourser(s)}}},[t._v(" payer ")]):t._e()])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.totals.a_payer)+" Fbu")]),e("th",[t._v(t._s(t.totals.payee)+" Fbu")]),e("th",[t._v(t._s(t.totals.reste)+" Fbu")]),e("th")])])])]),e("RemboursDialog",{attrs:{visible:t.rembours_opened,dette:t.active_dette},on:{close:function(e){t.rembours_opened=!1}}})],1)},Ee=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("client")]),e("th",[t._v("Date")]),e("th",[t._v("somme")]),e("th",[t._v("payée")]),e("th",[t._v("Reste")]),e("th",[t._v("options")])])])}],ze=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Client")])]),e("form",{attrs:{method:"post"}},[e("div",[t._v(" La somme à payer "),e("b",[t._v(t._s(t.money(t.reste)))]),t._v("Fbu ")]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_payee"}},[t._v("La somme payée")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.payee,expression:"payee"}],attrs:{type:"number",id:"id_payee"},domProps:{value:t.payee},on:{input:function(e){e.target.composing||(t.payee=e.target.value)}}})]),e("div",[t._v(" La somme à retourner "),e("b",[t._v(t._s(t.money(t.dette.reste-t.payee)))]),t._v("Fbu ")]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Payer"},on:{click:t.makePayment}})])])],1)])},Ze=[],je={props:{visible:{type:Boolean,default:!1},dette:{type:Object,required:!0}},data(){return{dette_p:null,logs:""}},computed:{payee:{get(){return""==this.dette_p?0:null!=this.dette_p?this.dette_p:this.reste},set(t){this.dette_p=t}},reste(){return this.dette.reste-this.dette.uncommited}},methods:{close(){this.dette_p=null,this.$emit("close")},makePayment(t){this.payee=this.payee>this.reste?this.reste:this.payee;let e={somme:this.payee,commande:this.dette.id},s={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().post(this.$store.state.url+"/paiement/",e,s).then((t=>{let e=t.data,s=this.$store.state.commandes.find((t=>t.id==this.dette.id)),a=this.$store.state.dettes.find((t=>t.id==this.dette.id));s&&(s.uncommited=e.somme),a&&(this.dette.uncommited+=e.somme),this.$emit("close")})).catch((t=>{t.response?this.logs=t.response.data.status:this.logs="une erreur est survenue"}))}}},Ue=je,Re=(0,m.Z)(Ue,ze,Ze,!1,null,"82aedf74",null),Ve=Re.exports,Je={components:{SearchBar:T,RemboursDialog:Ve},data(){return{dettes:this.$store.state.dettes,rembours_opened:!1,active_dette:{},query_date:!1}},computed:{totals(){let t={a_payer:0,payee:0,reste:0};if(0==this.dettes.length)return t;for(let e of this.dettes)t.a_payer+=e.a_payer,t.payee+=e.payee,t.reste+=e.reste-e.uncommited;return t}},methods:{searchItem(t){let e={};""!=t?(t=t.toLowerCase(),e=this.dettes.filter((e=>e.id==t||e.user.toLowerCase().includes(t)||this.datetime(e.date).includes(t)||e.client.toLowerCase().includes(t))),this.dettes=e):this.dettes=this.$store.state.dettes},rembourser(t){this.active_dette=t,this.rembours_opened=!0},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/commande/dettes/",t).then((t=>{this.$store.state.dettes=t.data,this.dettes=t.data,this.$store.state.dettes_fetched=!0})).catch((e=>{if("token_not_valid"==e.response.data.code){let e={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",e).then((e=>{this.$store.state.user.access=e.data.access,t.headers.Authorization="Bearer "+e.data.access})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/commande/dettes/"+e+"/"+s+"/",a).then((t=>{this.query_date=!0,this.dettes=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))}},mounted(){this.$store.state.dettes_fetched||this.fetchData()}},Qe=Je,Me=(0,m.Z)(Qe,Le,Ee,!1,null,"0d9b744c",null),Ge=Me.exports,He=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent"},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.performFilter}})],1),e("br"),t._m(0),e("br"),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[e("thead",{staticStyle:{"text-transform":"capitalize"}},[e("tr",{staticClass:"panier-item"},[e("th",[t._v("#")]),e("th",[t._v("nom & Prenom")]),e("th",[t._v("telephone")]),e("th",[t._v("montant")]),t.$store.state.user.groups.includes("admin")?e("th",[t._v("Status")]):t._e(),e("th",[t._v("date")]),e("th",[t._v("valider")]),e("th",[t.$store.state.user.groups.includes("admin")?e("button",{on:{click:function(e){t.add_mode=!0}}},[t._v("Ajouter")]):t._e()])])]),e("tbody",{attrs:{id:"paiements"}},t._l(t.items,(function(s,a){return e("tr",[e("td",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.nom)+" "+t._s(s.prenom))]),e("td",[t._v(t._s(s.telephone))]),e("td",[t._v(t._s(t.money(s.montant))+" Fbu")]),t.$store.state.user.groups.includes("admin")?e("td",[t._v(t._s(s.validated))]):t._e(),e("td",[t._v(t._s(t.datetime(s.date)))]),0==s.validated?e("td",[e("div",{staticClass:"btns"},[t.$store.state.user.groups.includes("admin")?e("button",{on:{click:function(e){return e.preventDefault(),t.startEdit(s)}}},[t._v("Edit")]):t._e(),t.$store.state.user.groups.includes("admin")?e("button",{staticStyle:{"background-color":"red"},on:{click:function(e){return e.preventDefault(),t.Delete(s)}}},[t._v("Delete")]):t._e()]),e("div",{staticClass:"btns"},[t.$store.state.user.groups.includes("gestionnaire")?e("button",{on:{click:function(e){return e.preventDefault(),t.Valider(s)}}},[t._v("valider")]):t._e()])]):e("td")])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total()))+" Fbu")]),e("th"),e("th"),e("th"),e("th")])])])]),e("EditDialog",{attrs:{visible:t.edit_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("AchatDialog",{attrs:{visible:t.achat_mode,produit:t.active_item},on:{close:t.exitEdition}}),e("ProduitDialog",{attrs:{visible:t.add_mode},on:{close:t.exitEdition}})],1)},Ke=[function(){var t=this,e=t._self._c;return e("div",[e("h2",{staticStyle:{"text-align":"center","text-transform":"uppercase"}},[t._v("All transactions")])])}],Xe=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h3",[t._v("Modifier "+t._s(t.produit.montant))])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.nom,expression:"new_produit.nom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.nom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.prenom,expression:"new_produit.prenom"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.prenom},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"prenom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Adresse:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.adresse,expression:"new_produit.adresse"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.adresse},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"adresse",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_unite"}},[t._v("Telephone:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.telephone,expression:"new_produit.telephone"}],attrs:{type:"text",id:"id_unite"},domProps:{value:t.new_produit.telephone},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"telephone",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Nouveau montant:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_produit.montant,expression:"new_produit.montant"}],attrs:{type:"number",name:"prix",placeholder:"prix",required:"",id:"id_quantite"},domProps:{value:t.new_produit.montant},on:{input:function(e){e.target.composing||t.$set(t.new_produit,"montant",e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerPrix}})])])],1)])},We=[],Ye={props:{visible:{type:Boolean,default:!1},produit:{type:Object,required:!0}},data(){return{logs:"",new_price:"",new_produit:""}},watch:{produit(t){this.new_produit=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerPrix(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().put(this.$store.state.url+`/transaction/${this.produit.id}/`,this.new_produit,t).then((t=>{let e=this.$store.state.transactions;for(var s=0;s<e.length;s++){let a=e[s];if(a.id==this.produit.id){this.$store.state.transactions[s]=t.data;break}}this.$emit("close")})).catch((t=>{console.error(t)}))}}},ts=Ye,es=(0,m.Z)(ts,Xe,We,!1,null,"35b4ac38",null),ss=es.exports,as=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{ref:"modal",staticClass:"popup-body",on:{click:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Creer Transaction")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.nom,expression:"transaction.nom"}],attrs:{type:"text",id:"id_nom",placeholder:"le nom "},domProps:{value:t.transaction.nom},on:{input:function(e){e.target.composing||t.$set(t.transaction,"nom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.prenom,expression:"transaction.prenom"}],attrs:{type:"text",id:"id_nom",placeholder:"le prenom"},domProps:{value:t.transaction.prenom},on:{input:function(e){e.target.composing||t.$set(t.transaction,"prenom",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Adresse:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.adresse,expression:"transaction.adresse"}],attrs:{type:"text",id:"id_nom",placeholder:"l'adresse'"},domProps:{value:t.transaction.adresse},on:{input:function(e){e.target.composing||t.$set(t.transaction,"adresse",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_entrant"}},[t._v("Telephone:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.telephone,expression:"transaction.telephone"}],attrs:{type:"text",id:"id_entrant",placeholder:"exemples: +25779462806"},domProps:{value:t.transaction.telephone},on:{input:function(e){e.target.composing||t.$set(t.transaction,"telephone",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_prix"}},[t._v("Montant:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.transaction.montant,expression:"transaction.montant"}],attrs:{type:"number",name:"prix",placeholder:"le montant",id:"id_prix"},domProps:{value:t.transaction.montant},on:{input:function(e){e.target.composing||t.$set(t.transaction,"montant",e.target.value)}}})]),e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("div",{staticClass:"buttons"},[e("button",{ref:"submit",on:{click:function(e){return e.preventDefault(),t.createTransaction.apply(null,arguments)}}},[t._v(" Créer ")])])])],1)])},is=[],rs={props:{visible:{type:Boolean,default:!1},modelaVisible:!0},data(){return{logs:"",transaction:{},new_price:"",csv_array:[],csvData:{size:0,fileData:[]}}},watch:{csv_array(t){if(0==t.length)return this.logs="",void(this.$refs.submit.innerText="Créer");this.logs=t.length+" transactions chargés",this.$refs.submit.innerText="upload"}},computed:{headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{close(){this.$emit("close")},createTransaction(){this.csv_array.length>0?this.uploadCSV():this.transaction.nom?this.transaction.prenom?this.transaction.adresse?this.transaction.telephone?(this.transaction.montant||(this.transaction.montant=0,this.logs=""),d().post(this.$store.state.url+"/transaction/",this.transaction,this.headers).then((t=>{this.transaction={},this.$store.state.transactions.push(t.data),this.$emit("close")})).catch((t=>{console.error(t)}))):this.logs="le telephone est obligatoire":this.logs="l'adresse est obligatoire":this.logs="le prenom est obligatoire":this.logs="le nom est obligatoire"},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},generateCSV(){let t='"sep=;"\nnom;unite;unite_sortant;rapport;prix_vente\n';this.download(t)},onPickFile(){this.$refs.fileInput.click()},loadCSV(t){if(t.target.files&&t.target.files[0]){let e=new FileReader;e.readAsBinaryString(t.target.files[0]),e.onload=t=>{this.csvData.size=t.total,this.csvData.fileData=t.target.result;let e=this.convertToJSON(this.csvData.fileData);this.csv_array=e}}},convertToJSON(t){let e=t.trim().split("\n"),s=[],a=e[0].trim().split(";"),i=[],r={};e=e.slice(1);for(let o=0;o<e.length;o++){i=e[o].trim().split(";");for(let t=0;t<i.length;t++)r[a[t]]=i[t];s.push(r),r={}}return s}}},os=rs,ns=(0,m.Z)(os,as,is,!1,null,"543919d2",null),ls=ns.exports,ds={components:{SearchBar:T,Item:Et,EditDialog:ss,AchatDialog:se,ProduitDialog:ls},data(){return{csvData:{},items:this.$store.state.transactions,active_item:{},edit_mode:!1,achat_mode:!1,add_mode:!1}},watch:{"$store.state.transactions"(t){this.items=t}},methods:{Delete(t){let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};confirm("Delete "+t.id)&&d()["delete"](this.$store.state.url+`/transaction/${t.id}/`,e).then((t=>(this.fetchData(),t)))},successAlert(){this.$swal({type:"success",title:"Valider la transaction",text:"Transaction validée avec succès!!!!"})},Valider(t){let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+`/transaction/${t.id}/valider/`,e).then((t=>{this.fetchData(),this.successAlert()}))},performFilter(t){let e=this.$store.state.transactions.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase())|e.telephone.toLowerCase().includes(t.toLowerCase())|e.prenom.toLowerCase().includes(t.toLowerCase())));this.items=e},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&d().get(this.$store.state.url+"/transaction/",t).then((t=>{this.$store.state.transactions=t.data.results,this.items=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},total(){let t=0;for(let e of this.items)1==e.validated&&(t+=e.montant);return t},exitEdition(){this.active_item={},this.edit_mode=!1,this.achat_mode=!1,this.add_mode=!1},startEdit(t){this.active_item=t,this.edit_mode=!0},startAchat(t){this.active_item=t,this.achat_mode=!0},download(t){const e=new Blob([t],{type:"text/csv"}),s=window.URL.createObjectURL(e),a=document.createElement("a");a.setAttribute("hidden",""),a.setAttribute("href",s),a.setAttribute("download","model.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a)},level(t){return 0==t?"empty":t<=5?"low":void 0},onPickFile(){this.$refs.fileInput.click()}},mounted(){this.fetchData()}},cs=ds,us=(0,m.Z)(cs,He,Ke,!1,null,"5d918f3e",null),hs=us.exports,ps=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:t.userIs("admin")},on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table achats"},[t._m(0),e("tbody",{attrs:{id:"achats"}},t._l(t.achats,(function(s,a){return e("tr",[e("td",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(s.quantite)+" "+t._s(s.unite))]),e("td",[t._v(t._s(t.money(s.prix_total))+" Fbu")]),e("td",[t._v(t._s(s.user))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t.userIs("admin")?e("button",{on:{click:function(e){return t.modifier(s)}}},[t._v(" modifier ")]):t._e()])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th"),e("th"),e("th")])])])]),e("AchatDialog",{attrs:{visible:t.achat_mode,achat:t.active_item,produit:t.produit},on:{close:t.exitEdition}})],1)},ms=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("#")]),e("th",[t._v("nom")]),e("th",[t._v("quantité")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("acheteur")]),e("th",[t._v("date")]),e("th")])])}],vs={data(){return{achats:this.$store.state.achats,query_date:!1,active_item:null,achat_mode:!1}},components:{SearchBar:T,AchatDialog:se},watch:{"$store.state.achats"(t){this.achats=this.$store.state.achats}},computed:{total(){let t=0;if(0==this.achats.length)return t;for(let e of this.achats)t+=e.prix_total;return t},produit(){if(!this.active_item)return{rapport:1};let t;return console.log(this.active_item),t=this.$store.state.produits.find((t=>t.nom==this.active_item.produit)),t}},methods:{searchItem(t){let e={};this.achats=this.$store.state.achats,""!=t&&(t=t.toLowerCase().split(","),e=this.achats.filter((e=>t[1]?(e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0]))&&(e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0])):e.id==t||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0])||e.produit.toLowerCase().includes(t[0]))),this.achats=e)},getMonday(){let t=new Date;var e=t.getDay(),s=t.getDate()-e+(0==e?-6:1);return new Date(t.setDate(s)).toISOString()},fetchAchats(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=`date__lte=${(new Date).toISOString()}&date__gte=${this.getMonday()}`;d().get(this.$store.state.url+`/achat/?${e}`,t).then((t=>{this.$store.state.achats=t.data.results,this.achats=t.data.results})).catch((e=>{if("token_not_valid"==e.response.data.code){let e={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",e).then((e=>{this.$store.state.user.access=e.data.access,t.headers.Authorization="Bearer "+e.data.access})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=new Date(t.du).toISOString(),s=new Date(t.au).toISOString(),a=`date__lte=${s}&date__gte=${e}`,i={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+`/achat/?${a}`,i).then((t=>{this.query_date=!0,this.$store.state.achats=t.data.results})).catch((t=>{this.query_date=!1,console.error(t)}))},modifier(t){this.active_item=t,this.achat_mode=!0},exitEdition(){this.achat_mode=!1}},mounted(){this.$store.state.achats_fetched||this.fetchAchats()}},_s=vs,fs=(0,m.Z)(_s,ps,ms,!1,null,"ff003a34",null),gs=fs.exports,bs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:t.userIs("admin")||t.userIs("gerant")},on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table commandes"},[t._m(0),e("tbody",{attrs:{id:"commandes"}},t._l(t.rations.results,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.salle.nom))]),e("td",[t._v(t._s(s.produit.designation))]),e("td",[t._v(t._s(s.quantite)+" "+t._s(s.produit.unite))]),e("td",[e("div",{staticClass:"btns"},[e("button",{on:{click:function(e){return t.showDetails(s)}}},[t._v(" détails ")])])])])})),0)])]),e("DetailsDialog",{attrs:{visible:t.details_opened,commande:t.active_commande},on:{close:function(e){t.details_opened=!1}}})],1)},ys=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("Date")]),e("th",[t._v("Salle")]),e("th",[t._v("Produit")]),e("th",[t._v("Quantite")]),e("th",[t._v("options")])])])}],Cs=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("center",[e("h2",[t._v("Ventes")])]),0==t.ventes.length?e("div",[t._v(t._s(t.action))]):e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table commandes"},[t._m(0),e("tbody",{attrs:{id:"commandes"}},t._l(t.ventes,(function(s){return e("tr",[e("td",{staticStyle:{color:"#aaa"}},[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v("x "+t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.prix_achat))+" Fbu")]),e("td",[t._v(t._s(t.money(s.prix_vente))+" Fbu")]),e("td",[t._v(t._s(t.money(s.prix_vente*s.quantite))+" Fbu")])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.commande.a_payer))+" Fbu")])])])])])],1)])},ws=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("quantite")]),e("th",[t._v("prix achat")]),e("th",[t._v("prix vente")]),e("th",[t._v("total")])])])}],$s={data(){return{ventes:[],action:"récuperation des ventes..."}},props:{visible:{type:Boolean,default:!1},commande:{type:Object,required:!0}},watch:{visible(t){if(this.visible){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/vente/?commande="+this.commande.id,t).then((t=>{this.ventes=t.data,this.action="pas de details."})).catch((t=>{console.error(t)}))}}},methods:{close(){this.$emit("close")}}},xs=$s,qs=(0,m.Z)(xs,Cs,ws,!1,null,"4e800220",null),ks=qs.exports,Ds={components:{SearchBar:T,DetailsDialog:ks},data(){return{query_date:!1,rations:this.$store.state.rations,details_opened:!1,active_commande:{}}},computed:{totals(){let t={a_payer:0,payee:0,reste:0};if(0==this.commandes.length)return t;for(let e of this.commandes)t.a_payer+=e.a_payer,t.payee+=e.payee,t.reste+=e.reste;return t}},methods:{userIs(t){return this.$store.state.user.groups.includes(t)},searchItem(t){let e={};""!=t&&(t=t.toLowerCase(),t=t.toLowerCase().split(","),e=this.commandes.filter((e=>t[1]?(e.id==t[0]||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0]))&&(e.id==t[1]||e.user.toLowerCase().includes(t[1])||this.datetime(e.date).includes(t[1])):e.id==t[0]||e.user.toLowerCase().includes(t[0])||this.datetime(e.date).includes(t[0]))),this.$store.state.commandes_fetched=!1,this.commandes=e)},showDetails(t){this.active_commande=t,this.details_opened=!0},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/ration/",t).then((t=>{this.$store.state.rations=t.data,this.rations=t.data,this.$store.state.commandes_fetched=!0})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,this.fetchData()})).catch((t=>{this.$store.state.user=null}))}}))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+`/commande/?du=${e}&au=${s}`,a).then((t=>{this.query_date=!0,this.commandes=t.data})).catch((t=>{this.query_date=!1,console.log(t)}))}},mounted(){this.fetchData()}},Ps=Ds,Ss=(0,m.Z)(Ps,bs,ys,!1,null,"372379b6",null),As=Ss.exports,Bs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table ventes"},[t._m(0),e("tbody",{attrs:{id:"ventes"}},t._l(Object.entries(t.grouped_ventes),(function(s){return e("tr",[e("td",[t._v(t._s(s[1].id))]),e("td",[t._v(t._s(s[0]))]),e("td",[t._v(t._s(s[1].quantite))]),e("td",[t._v(t._s(t.money(s[1].prix_achat||null)))]),e("td",[t._v(t._s(t.money(s[1].prix_vente)))]),e("td",[t._v(t._s(s[1].prix_achat?t.money(s[1].benefice):"-"))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.totals.achat))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.vente))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.benefice))+" Fbu")])])])])])])},Ns=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("quantité vendue")]),e("th",[t._v("prix d'achat total")]),e("th",[t._v("prix de vente total")]),e("th",[t._v("benefice")])])])}],Is={components:{SearchBar:T},data(){return{ventes:[],query_date:!1}},computed:{totals(){let t={achat:0,vente:0,benefice:0};for(let e of Object.entries(this.grouped_ventes))t.vente+=e[1].prix_vente||0,t.achat+=e[1].prix_achat||0,t.benefice+=e[1].benefice||0;return t},grouped_ventes(){let t={},e=null,s=0,a=0;for(let i of this.ventes)s=i.prix_vente*i.quantite,a=i.prix_achat*i.quantite,i.produit in t?(e=t[i.produit],e.quantite+=i.quantite,e.prix_vente+=s,e.prix_achat+=a,e.benefice+=i.prix_achat?s-a:0):e={id:i.produit_id,quantite:i.quantite,prix_achat:i.prix_achat*i.quantite,prix_vente:i.prix_vente*i.quantite,benefice:i.prix_achat?s-a:null},t[i.produit]=e;return t}},methods:{totalAchat(t){return t&&t.prix_achat?t.prix_achat*t.quantite:0},totalVente(t){return t?t.prix_vente*t.quantite:0},searchItem(t){this.ventes=""==t?this.$store.state.ventes:this.$store.state.ventes.filter((e=>e.produit.toLowerCase().includes(t.toLowerCase())))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}},i=`/vente/?commande__date__gte=${e} 00:00&commande__date__lte=${s} 23:59`;d().get(this.$store.state.url+i,a).then((t=>{this.ventes=t.data})).catch((t=>{console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=new Date,s=(new Date).toISOString(),a=new Date(e.setDate(1)).toISOString(),i=`/vente/?commande__date__gte=${a}&commande__date__lte=${s}`;d().get(this.$store.state.url+i,t).then((t=>{this.$store.state.ventes=t.data,this.ventes=t.data})).catch((t=>{}))}},mounted(){this.fetchData()}},Os=Is,Ts=(0,m.Z)(Os,Bs,Ns,!1,null,"47bf9038",null),Fs=Ts.exports,Ls=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table ventes"},[t._m(0),e("tbody",{attrs:{id:"ventes"}},t._l(Object.entries(t.grouped_ventes),(function(s){return e("tr",[e("td",[t._v(t._s(s[1].id))]),e("td",[t._v(t._s(s[0]))]),e("td",[t._v(t._s(s[1].quantite))]),e("td",[t._v(t._s(t.money(s[1].prix_achat||null)))]),e("td",[t._v(t._s(t.money(s[1].prix_vente)))]),e("td",[t._v(t._s(s[1].prix_achat?t.money(s[1].benefice):"-"))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"3"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.totals.achat))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.vente))+" Fbu")]),e("th",[t._v(t._s(t.money(t.totals.benefice))+" Fbu")])])])])])])},Es=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("quantité vendue")]),e("th",[t._v("prix d'achat total")]),e("th",[t._v("prix de vente total")]),e("th",[t._v("benefice")])])])}],zs={components:{SearchBar:T},data(){return{ventes:[],query_date:!1}},computed:{totals(){let t={achat:0,vente:0,benefice:0};for(let e of Object.entries(this.grouped_ventes))t.vente+=e[1].prix_vente||0,t.achat+=e[1].prix_achat||0,t.benefice+=e[1].benefice||0;return t},grouped_ventes(){let t={},e=null,s=0,a=0;for(let i of this.ventes)s=i.prix_vente*i.quantite,a=i.prix_achat*i.quantite,i.produit in t?(e=t[i.produit],e.quantite+=i.quantite,e.prix_vente+=s,e.prix_achat+=a,e.benefice+=i.prix_achat?s-a:0):e={id:i.produit_id,quantite:i.quantite,prix_achat:i.prix_achat*i.quantite,prix_vente:i.prix_vente*i.quantite,benefice:i.prix_achat?s-a:null},t[i.produit]=e;return t}},methods:{totalAchat(t){return t&&t.prix_achat?t.prix_achat*t.quantite:0},totalVente(t){return t?t.prix_vente*t.quantite:0},searchItem(t){this.ventes=""==t?this.$store.state.ventes:this.$store.state.ventes.filter((e=>e.produit.toLowerCase().includes(t.toLowerCase())))},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}},i=`/vente/?commande__date__gte=${e} 00:00&commande__date__lte=${s} 23:59`;d().get(this.$store.state.url+i,a).then((t=>{this.ventes=t.data})).catch((t=>{console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=new Date,s=(new Date).toISOString(),a=new Date(e.setDate(1)).toISOString(),i=`/vente/?commande__date__gte=${a}&commande__date__lte=${s}`;d().get(this.$store.state.url+i,t).then((t=>{this.$store.state.ventes=t.data,this.ventes=t.data})).catch((t=>{}))}},mounted(){this.fetchData()}},Zs=zs,js=(0,m.Z)(Zs,Ls,Es,!1,null,"60d1c676",null),Us=js.exports,Rs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table stats"},[t._m(0),e("tbody",{attrs:{id:"stats"}},t._l(t.stats,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.nom))]),e("td",[t._v(t._s(s.tel))]),e("td",[t._v(t._s(s.commande))]),e("td",[t._v(t._s(t.money(s.total)))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")])])])])])])},Vs=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("client")]),e("th",[t._v("télephone")]),e("th",[t._v("nombre de fois")]),e("th",[t._v("la somme payée")])])])}],Js={components:{SearchBar:T},data(){return{query_date:!1,stats:[]}},methods:{searchItem(t){let e={};if(""==t)return this.fetchData();e=this.query_date||""==t?this.stats.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase()))):this.$store.state.stats.filter((e=>e.id==t|e.nom.toLowerCase().includes(t.toLowerCase()))),this.stats=e},filterByDate(t){let e=t.du,s=t.au,a={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/statistic/clients/"+e+"/"+s+"/",a).then((t=>{this.query_date=!0,this.stats=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/statistic/clients/",t).then((t=>{this.$store.state.stats=t.data,this.stats=t.data,console.log(t.data)})).catch((t=>{}))}},computed:{total(){let t=0;if(0==this.stats.length)return t;for(let e of this.stats)t+=e.total;return t}},mounted(){this.fetchData()}},Qs=Js,Ms=(0,m.Z)(Qs,Rs,Vs,!1,null,"3ab8d813",null),Gs=Ms.exports,Hs=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{on:{changed:t.filterByDate,searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table pertes"},[t._m(0),e("tbody",{attrs:{id:"pertes"}},t._l(t.pertes,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(t.datetime(t.since)))]),e("td",[t._v(t._s(t.datetime(t.to)))]),e("td",[t._v(t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.total)))])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"5"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")])])])])])])},Ks=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("du")]),e("th",[t._v("au")]),e("th",[t._v("quantité perdu")]),e("th",[t._v("prix d'achat")])])])}],Xs={components:{SearchBar:T},data(){return{query_date:!1,pertes:[],to:String(new Date),since:new Date((new Date).setUTCDate((new Date).getUTCDate()-7))}},computed:{total(){let t=0;if(0==this.pertes.length)return t;for(let e of this.pertes)t+=e.total;return t}},methods:{searchItem(t){let e={};if(""==t)return this.fetchData();e=(this.query_date,this.pertes.filter((e=>e.id==t|e.produit.toLowerCase().includes(t.toLowerCase())))),this.pertes=e},filterByDate(t){this.since=t.du,this.to=t.au;let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/perte/stats/"+this.since+"/"+this.to+"/",e).then((t=>{this.query_date=!0,this.pertes=t.data})).catch((t=>{this.query_date=!1,console.error(t)}))},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().get(this.$store.state.url+"/perte/stats/",t).then((t=>{this.pertes=t.data})).catch((t=>{}))}},mounted(){this.fetchData()}},Ws=Xs,Ys=(0,m.Z)(Ws,Hs,Ks,!1,null,"927bcece",null),ta=Ys.exports,ea=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table paiements"},[t._m(0),e("tbody",{attrs:{id:"paiements"}},t._l(t.paiements,(function(s){return e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.commande))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(t.money(s.somme))+" Fbu")]),e("td",[e("div",{staticClass:"btns"},[t.user.is_admin?e("button",{on:{click:function(e){return t.validatePay(s)}}},[t._v("valider")]):t._e(),e("button",{on:{click:function(e){return t.deletePay(s)}}},[t._v("annuler")])])])])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("total")]),e("th"),e("th"),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th",[t.user.is_admin?e("button",[t._v(" valider tout ")]):t._e()])])])])])])},sa=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("commande")]),e("th",[t._v("Date")]),e("th",[t._v("somme")]),e("th",[t._v("options")])])])}],aa={components:{SearchBar:T},data(){return{paiements:this.$store.state.paiements,rembours_opened:!1,active_paiement:{},query_date:!1}},computed:{total(){let t=0;if(0==this.paiements.length)return t;for(let e of this.paiements)t+=e.somme;return t},user(){return this.$store.state.user},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{searchItem(t){let e={};if(""==t)return this.fetchPayements();e=this.query_date||""==t?this.paiements.filter((e=>e.id==t|e.commande.toLowerCase().includes(t.toLowerCase()))):this.$store.state.paiements.filter((e=>e.id==t|e.commande.toLowerCase().includes(t.toLowerCase()))),this.paiements=e},rembourser(t){this.active_paiement=t,this.rembours_opened=!0},deletePay(t){confirm("êtes-vous sur de vouloir annuler la paiement?")&&d()["delete"](this.$store.state.url+`/paiement/${t.id}/`,this.headers).then((e=>{let s=this.$store.state.paiements.indexOf(t),a=this.$store.state.commandes.find((e=>e.id==t.commande_id)),i=this.$store.state.dettes.find((e=>e.id==t.commande_id));a&&(a.uncommited-=t.somme),i&&(i.uncommited-=t.somme),this.$store.state.paiements.splice(s,1)})).catch((t=>{console.error(t)}))},validatePay(t){if(confirm("avez-vous vraiment recu l'argent liquide?")){let e={validated:!0};d().patch(this.$store.state.url+`/paiement/${t.id}/`,e,this.headers).then((e=>{let s=this.$store.state.paiements.indexOf(t),a=this.$store.state.commandes.find((e=>e.id==t.commande_id)),i=this.$store.state.dettes.find((e=>e.id==t.commande_id));if(a&&(a.payee+=t.somme,a.uncommited-=t.somme),i)if(i.reste-=t.somme,i.reste<=0){let t=this.$store.state.dettes.indexOf(i);this.$store.state.dettes.splice(t,1)}else i.payee+=t.somme,i.uncommited-=t.somme;this.$store.state.paiements.splice(s,1)})).catch((t=>{console.error(t)}))}},validateAllPay(){},fetchPayements(){d().get(this.$store.state.url+"/paiement/",this.headers).then((t=>{this.$store.state.paiements=t.data,this.paiements=t.data})).catch((t=>{if("token_not_valid"==t.response.data.code){let t={refresh:this.$store.state.user.refresh};d().post(this.$store.state.url+"/refresh/",t).then((t=>{this.$store.state.user.access=t.data.access,headers.headers.Authorization="Bearer "+t.data.access})).catch((t=>{console.error(t)}))}}))}},mounted(){0==this.paiements.length&&this.fetchPayements()}},ia=aa,ra=(0,m.Z)(ia,ea,sa,!1,null,"58ced1b9",null),oa=ra.exports,na=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table pertes"},[t._m(0),e("tbody",{attrs:{id:"pertes"}},t._l(t.pertes,(function(s){return s.validated?t._e():e("tr",[e("td",[t._v(t._s(s.id))]),e("td",[t._v(t._s(s.produit))]),e("td",[t._v(t._s(t.datetime(s.date)))]),e("td",[t._v(t._s(s.quantite))]),e("td",[t._v(t._s(t.money(s.prix_vente*s.quantite)))]),e("td",[t._v(t._s(s.details))]),t.userIs("admin")?e("td",[e("button",{on:{click:function(e){return t.acceptPerte(s)}}},[t._v("Accepter")]),e("button",{on:{click:function(e){return t.deletePerte(s)}}},[t._v("Refuser")])]):t._e()])})),0),e("tfoot",[e("tr",{staticClass:"panier-item"},[e("th",{attrs:{colspan:"4"}},[t._v("total")]),e("th",[t._v(t._s(t.money(t.total))+" Fbu")]),e("th",[e("button",{on:{click:function(e){t.perte_shown=!0}}},[t._v("ajouter")])]),t.userIs("admin")?e("th",[e("button",[t._v("Tout accepter")]),e("button",[t._v("Tout refuser")])]):t._e()])])])]),e("PerteDialog",{attrs:{visible:t.perte_shown},on:{"update:visible":function(e){t.perte_shown=e},close:function(e){t.perte_shown=!1},added:t.pushPerte}})],1)},la=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("id")]),e("th",[t._v("produit")]),e("th",[t._v("date")]),e("th",[t._v("quantité perdu")]),e("th",[t._v("prix d'achat")]),e("th",[t._v("motif")]),e("th")])])}],da=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible},on:{click:t.close}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()},keydown:function(t){t.stopPropagation()}}},[e("center",[e("h3",[t._v("Perte")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_nom"}},[t._v("Nom du produit")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nom_produit,expression:"nom_produit"}],attrs:{type:"text",list:"noms"},domProps:{value:t.nom_produit},on:{input:function(e){e.target.composing||(t.nom_produit=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_quantite"}},[t._v("Quantité")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.quantite,expression:"quantite"}],attrs:{type:"number"},domProps:{value:t.quantite},on:{input:function(e){e.target.composing||(t.quantite=e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_tel"}},[t._v("Détails")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.details,expression:"details"}],attrs:{list:"tels"},domProps:{value:t.details},on:{input:function(e){e.target.composing||(t.details=e.target.value)}}})]),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Soumettre"},on:{click:t.postPerte}})])]),e("datalist",{attrs:{id:"noms"}},t._l(t.produits,(function(t){return e("option",{domProps:{value:t.nom}})})),0)],1)])},ca=[],ua={props:{visible:{type:Boolean,default:!1}},data(){return{logs:"",nom_produit:"",quantite:0,details:""}},computed:{produits(){return this.$store.state.produits}},methods:{close(){this.$emit("close")},postPerte(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}},e=this.$store.state.produits.find((t=>t.nom==this.nom_produit)),s={produit:e.id,quantite:this.quantite,details:this.details};s.quantite<=0?this.logs="cette quantité est invalide":s.details.length<7?this.logs="vous devez donner un justification valide":d().post(this.$store.state.url+"/perte/",s,t).then((t=>{this.$emit("added",t.data),e.quantite-=t.data.quantite,this.close()})).catch((t=>{t.response?this.logs=t.response.data.status:(this.logs="une erreur est survenue",console.error(t))}))}}},ha=ua,pa=(0,m.Z)(ha,da,ca,!1,null,"c0464c96",null),ma=pa.exports,va={components:{SearchBar:T,PerteDialog:ma},data(){return{pertes:[],perte_shown:!1}},computed:{total(){let t=0;if(0==this.pertes.length)return t;for(let e of this.pertes)e.validated||(t+=e.prix_vente*e.quantite);return t},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}}},methods:{userIs(t){return this.$store.state.user.groups.includes(t)},searchItem(t){let e=this.$store.state.pertes.filter((e=>e.id==t|e.produit.toLowerCase().includes(t.toLowerCase())));this.pertes=e},pushPerte(t){this.pertes.push(t)},acceptPerte(t){if(confirm("Acceptez-vous vraiment cette perte?")){console.log("triggered");let e={validated:!0};d().patch(this.$store.state.url+`/perte/${t.id}/`,e,this.headers).then((e=>{t.validated=!0})).catch((t=>{console.error(t)}))}},deletePerte(t){if(confirm("Etes vous sur de supprimer cette perte?\nNB: Si vous supprimez cette perte, sa quantité sera réajoutée dans le stock")){d()["delete"](this.$store.state.url+`/perte/${t.id}/`,this.headers).then((e=>{this.pertes.splice(this.pertes.indexOf(t),1),this.$store.state.produits.find((e=>e.id==t.produit_id)).quantite+=t.quantite})).catch((t=>{console.error(t)}))}}},mounted(){d().get(this.$store.state.url+"/perte/",this.headers).then((t=>{this.$store.state.pertes=t.data,this.pertes=t.data})).catch((t=>{console.error(t)}))}},_a=va,fa=(0,m.Z)(_a,na,la,!1,null,"26799ea6",null),ga=fa.exports,ba=function(){var t=this,e=t._self._c;return e("div",{staticClass:"parent",on:{click:function(e){t.popover_opened=!1}}},[e("div",{staticClass:"top"},[e("SearchBar",{attrs:{show_date:!1},on:{searched:t.searchItem}})],1),e("div",{staticClass:"recycler"}),e("div",{staticClass:"scrollable-tab"},[e("table",{staticClass:"table users"},[t._m(0),e("tbody",{attrs:{id:"users"}},t._l(t.users,(function(s,a){return e("tr",[e("td",[t._v(t._s(a+1))]),e("td",[t._v(t._s(s.username))]),e("td",[t._v(t._s(s.first_name))]),e("td",[t._v(t._s(s.last_name))]),e("td",[t._v(t._s(s.is_active))]),e("td",{staticClass:"groups"},t._l(s.groups,(function(s){return e("span",[t._v(" "+t._s(s)),e("span",{staticClass:"comma"},[t._v(",")])])})),0),e("td",[e("div",{staticClass:"btns"},[t.permited(s)?e("button",{on:{click:function(e){return t.editUser(s)}}},[t._v(" editer ")]):t._e(),t.editable(s)?e("span",[s.is_active?e("button",{on:{click:function(e){return t.deactivateUser(s)}}},[t._v("desactiver")]):e("button",{on:{click:function(e){return t.activateUser(s)}}},[t._v("activer")])]):t._e()])]),e("td")])})),0)])]),e("EditUser",{attrs:{visible:t.edit_mode,item:t.active_user},on:{close:t.exitEdition}})],1)},ya=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",{staticClass:"panier-item"},[e("th",[t._v("#")]),e("th",[t._v("username")]),e("th",[t._v("prenom")]),e("th",[t._v("nom")]),e("th",[t._v("actif")]),e("th",[t._v("groupes")]),e("th",[t._v("options")]),e("th",[e("button",[t._v("Ajouter")])])])])}],Ca=function(){var t=this,e=t._self._c;return e("div",{class:{popup:!0,active:t.visible}},[e("div",{staticClass:"popup-body",on:{click:function(t){t.preventDefault(),t.stopPropagation()}}},[e("div",{staticClass:"head"},[e("h3",[t._v("Modifier Utilisateur")]),e("button",{staticClass:"close",on:{click:t.close}},[t._v("x")])]),e("form",{attrs:{method:"post"}},[e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_username"}},[t._v("Username:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.username,expression:"new_user.username"}],attrs:{type:"text",id:"id_username"},domProps:{value:t.new_user.username},on:{input:function(e){e.target.composing||t.$set(t.new_user,"username",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_first_name"}},[t._v("Prenom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.first_name,expression:"new_user.first_name"}],attrs:{type:"text",id:"id_first_name"},domProps:{value:t.new_user.first_name},on:{input:function(e){e.target.composing||t.$set(t.new_user,"first_name",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_last_name"}},[t._v("Nom:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.last_name,expression:"new_user.last_name"}],attrs:{type:"text",id:"id_last_name"},domProps:{value:t.new_user.last_name},on:{input:function(e){e.target.composing||t.$set(t.new_user,"last_name",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_first_name"}},[t._v(" Mot de passe: ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.new_user.password,expression:"new_user.password"}],attrs:{type:"password",id:"id_psswd"},domProps:{value:t.new_user.password},on:{input:function(e){e.target.composing||t.$set(t.new_user,"password",e.target.value)}}})]),e("div",{staticClass:"field"},[e("label",{attrs:{for:"confirm"}},[t._v(" confirmation: ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.confirm,expression:"confirm"}],attrs:{type:"password",id:"confirm"},domProps:{value:t.confirm},on:{input:function(e){e.target.composing||(t.confirm=e.target.value)}}})]),t.is_admin?e("div",{staticClass:"field"},[e("label",{attrs:{for:"id_group"}},[t._v("Groupe:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.group,expression:"group"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.group=e.target.multiple?s:s[0]}}},t._l(t.groups,(function(s){return e("option",{domProps:{selected:t.user.groups.includes(s),value:s}},[t._v(" "+t._s(s)+" ")])})),0)]):t._e(),e("div",{staticClass:"buttons"},[e("div",{staticClass:"logs"},[t._v(t._s(t.logs))]),e("input",{attrs:{type:"submit",value:"Modifier"},on:{click:t.changerUser}})])])])])},wa=[],$a={props:{visible:{type:Boolean,default:!1},item:{type:Object,required:!0}},data(){return{logs:"",new_user:{},group:"",groups:["admin","gestionnaire","agent"],confirm:""}},computed:{is_admin(){return this.$store.state.user.is_admin}},watch:{item(t){this.new_user=JSON.parse(JSON.stringify(t))}},methods:{close(){this.$emit("close")},changerUser(){let t={username:this.new_user.username,first_name:this.new_user.first_name,last_name:this.new_user.last_name};if(this.group&&(t["group"]=this.group),this.new_user.password){if(this.new_user.password!=this.confirm)return void(this.logs="les mot de passes doivent être identiques");if(this.new_user.password.length<6)return void(this.logs="le mot de passe doit avoir au moins 6 caractères");t["password"]=this.new_user.password}let e={headers:{Authorization:"Bearer "+this.$store.state.user.access}};d().put(this.$store.state.url+`/user/${this.item.id}/`,t,e).then((t=>{Object.assign(this.item,t.data),this.$emit("close")})).catch((t=>{console.error(t)}))}}},xa=$a,qa=(0,m.Z)(xa,Ca,wa,!1,null,"8c507118",null),ka=qa.exports,Da={components:{SearchBar:T,EditUser:ka},data(){return{query_date:!1,edit_mode:!1,users:this.$store.state.users,details_opened:!1,active_user:{groups:[]}}},computed:{},methods:{editable(t){return this.$store.state.user.is_admin&&t.id!=this.$store.state.user.id},permited(t){return this.$store.state.user.is_admin||this.$store.state.user.id==t.id},searchItem(t){let e={};if(""==t)return this.fetchData();e=this.query_date||""==t?this.users.filter((e=>e.id==t|e.client.toLowerCase().includes(t.toLowerCase()))):this.$store.state.users.filter((e=>e.id==t|e.client.toLowerCase().includes(t.toLowerCase()))),this.users=e},fetchData(){let t={headers:{Authorization:"Bearer "+this.$store.state.user.access}};0==this.$store.state.users.length&&d().get(this.$store.state.url+"/user/",t).then((t=>{this.$store.state.users=t.data.results,this.users=t.data.results,console.log(t.data.results)})).catch((t=>{t.response||console.error(t)}))},headers(){return{headers:{Authorization:"Bearer "+this.$store.state.user.access}}},deactivateUser(t){confirm("voulez-vous vraiment arreter cette utilisateur?")&&d().put(this.$store.state.url+`/user/${t.id}/`,{is_active:!1},this.headers()).then((e=>{Object.assign(t,e.data)})).catch((t=>{console.error(t)}))},activateUser(t){confirm("voulez-vous mettre cette utilisateur en action?")&&d().put(this.$store.state.url+`/user/${t.id}/`,{is_active:!0},this.headers()).then((e=>{Object.assign(t,e.data)})).catch((t=>{console.error(t)}))},exitEdition(t){this.edit_mode=!1},editUser(t){this.edit_mode=!0,this.active_user=t}},mounted(){this.fetchData()}},Pa=Da,Sa=(0,m.Z)(Pa,ba,ya,!1,null,"12758f30",null),Aa=Sa.exports;r.ZP.use(D.ZP);const Ba=[{path:"/",name:"",component:gt},{path:"/home/oeufs",name:"oeufs",component:tt},{path:"/home/ration",name:"ration",component:gt},{path:"/home/poulet",name:"poulet",component:At},{path:"/stock/produit",name:"produit",component:oe},{path:"/stock/salle",name:"salle",component:Ae},{path:"/stock/oeuf",name:"oeuf",component:Fe},{path:"/hist/dettes",name:"dettes",component:Ge},{path:"/hist/achats",name:"achats",component:gs},{path:"/hist/rations",name:"rations",component:As},{path:"/hist/paiements",name:"paiements",component:oa},{path:"/stats/product",name:"statsoeuf",component:Fs},{path:"/stats/oeuf",name:"statsproduct",component:Us},{path:"/stats/clients",name:"statsclients",component:Gs},{path:"/stats/pertes",name:"statspertes",component:ta},{path:"/pertes",name:"pertes",component:ga},{path:"/users",name:"users",component:Aa},{path:"/transactions",name:"transactions",component:hs}],Na=new D.ZP({mode:"history",base:"/",routes:Ba});var Ia=Na,Oa=s(408);r.ZP.use(Oa.ZP);var Ta=new Oa.ZP.Store({state:{user:null,clients:[],url:"/api",produits:[],salles:[],oeufs:[],achats:[],transactions:[],pertes:[],commandes:[],paiements:[],rations:[],users:[],dettes:[],achats_fetched:!1,dettes_fetched:!1,commandes_fetched:!1,cart:new Object({content:[],getTotal(){let t=0;for(let e=0;e<this.content.length;e++)t+=this.content[e].getTotal();return t},getLength(){return this.content.length},find(t){for(let e=0;e<this.content.length;e++){let s=this.content[e];if(s.product.id==t)return e}return-1},getQuantite(t){let e=this.find(t);return e>=0?this.content[e].quantite:0},increase(t){let e=this.find(t);if(e>=0){let t=this.content[e];t.quantite<t.product.quantite&&t.quantite++}},decrease(t){let e=this.find(t);if(e>=0){let t=this.content[e];t.quantite>1?t.quantite--:this.content.splice(e,1)}},add(t,e){if(0==t.quantite)return;let s=this.find(t.id);if(s>=0)e&&t.quantite>e?this.content[s].quantite=e:this.increase(t.id);else{let s=new Object({product:t,quantite:e||1,getTotal(){return this.product.prix_unitaire*this.quantite}});this.content.push(s)}}})},mutations:{},actions:{},modules:{}}),Fa=s(7979),La=s(9946),Ea=s(4984),za=s(1590),Za=s.n(za);r.ZP.use(Za()),Fa.vI.add(La.sq$,La.IA$,La.FVb,La.koM,La.IwR,La.I7k,La.LEp,La.oFW,La.oTz,La.q7m,La.cf$),r.ZP.component("fa",Ea.GN),r.ZP.mixin({methods:{money(t){return void 0==t||null==t?"-":t.toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")},datetime(t){if(!t)return"-";let e=new Date(t);return new Intl.DateTimeFormat("en-GB",{dateStyle:"short",timeStyle:"short"}).format(e)},userIs(t){return this.user.groups.includes(t)}},computed:{user(){return this.$store.state.user}}}),r.ZP.config.productionTip=!1,new r.ZP({router:Ia,store:Ta,render:t=>t(k)}).$mount("#app")}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a].call(r.exports,r,r.exports,s),r.exports}s.m=t,function(){var t=[];s.O=function(e,a,i,r){if(!a){var o=1/0;for(c=0;c<t.length;c++){a=t[c][0],i=t[c][1],r=t[c][2];for(var n=!0,l=0;l<a.length;l++)(!1&r||o>=r)&&Object.keys(s.O).every((function(t){return s.O[t](a[l])}))?a.splice(l--,1):(n=!1,r<o&&(o=r));if(n){t.splice(c--,1);var d=i();void 0!==d&&(e=d)}}return e}r=r||0;for(var c=t.length;c>0&&t[c-1][2]>r;c--)t[c]=t[c-1];t[c]=[a,i,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var i,r,o=a[0],n=a[1],l=a[2],d=0;if(o.some((function(e){return 0!==t[e]}))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);if(l)var c=l(s)}for(e&&e(a);d<o.length;d++)r=o[d],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(c)},a=self["webpackChunkinkoko_ui1"]=self["webpackChunkinkoko_ui1"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(8839)}));a=s.O(a)})();
//# sourceMappingURL=app.b7e6e9d8.js.map